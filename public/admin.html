<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Admin Panel Pro - DROGUA CENTER</title>
  <style>
    :root {
      --bg: #0a0e14;
      --bg-secondary: #0d1419;
      --card: #151b23;
      --card-hover: #1a212b;
      --text: #e8edf2;
      --text-secondary: #b4c0ce;
      --muted: #7a8594;
      --accent: #5ba3f5;
      --accent-hover: #6baff7;
      --accent-light: rgba(91, 163, 245, 0.1);
      --border: #2a3441;
      --success: #10b981;
      --danger: #ef4444;
      --warning: #f59e0b;
      --info: #3b82f6;
      --gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --shadow-sm: 0 2px 4px rgba(0,0,0,0.2);
      --shadow-md: 0 4px 12px rgba(0,0,0,0.3);
      --shadow-lg: 0 10px 30px rgba(0,0,0,0.4);
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    [data-theme="light"] {
      --bg: #f8fafc;
      --bg-secondary: #ffffff;
      --card: #ffffff;
      --card-hover: #f1f5f9;
      --text: #1e293b;
      --text-secondary: #475569;
      --muted: #94a3b8;
      --border: #e2e8f0;
      --accent-light: rgba(91, 163, 245, 0.1);
      --shadow-sm: 0 1px 3px rgba(0,0,0,0.1);
      --shadow-md: 0 4px 6px rgba(0,0,0,0.1);
      --shadow-lg: 0 10px 15px rgba(0,0,0,0.1);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      transition: var(--transition);
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes slideDown {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    @keyframes shimmer {
      0% { background-position: -1000px 0; }
      100% { background-position: 1000px 0; }
    }

    .container {
      max-width: 1600px;
      margin: 0 auto;
      padding: 20px;
      animation: fadeIn 0.5s ease;
    }

    .header {
      background: var(--card);
      border-radius: 20px;
      padding: 24px 32px;
      margin-bottom: 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: var(--shadow-md);
      animation: slideDown 0.5s ease;
      border: 1px solid var(--border);
    }

    .header h1 {
      font-size: 28px;
      font-weight: 800;
      background: var(--gradient);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .header-actions {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .theme-toggle {
      width: 50px;
      height: 26px;
      background: var(--border);
      border-radius: 26px;
      position: relative;
      cursor: pointer;
      transition: var(--transition);
    }

    .theme-toggle::after {
      content: 'üåô';
      position: absolute;
      top: 3px;
      left: 3px;
      width: 20px;
      height: 20px;
      background: var(--bg);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      transition: var(--transition);
    }

    .theme-toggle.light {
      background: var(--accent);
    }

    .theme-toggle.light::after {
      content: '‚òÄÔ∏è';
      left: calc(100% - 23px);
      background: white;
    }

    #auth {
      max-width: 450px;
      margin: 100px auto;
      background: var(--card);
      padding: 40px;
      border-radius: 24px;
      border: 1px solid var(--border);
      box-shadow: var(--shadow-lg);
      animation: fadeIn 0.5s ease;
    }

    #auth h2 {
      font-size: 32px;
      margin-bottom: 30px;
      text-align: center;
      background: var(--gradient);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    input, button, select, textarea {
      padding: 14px 18px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: var(--bg-secondary);
      color: var(--text);
      width: 100%;
      font-size: 14px;
      margin-bottom: 12px;
      font-family: inherit;
      transition: var(--transition);
    }

    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px var(--accent-light);
    }

    button {
      background: var(--gradient);
      color: white;
      border: none;
      cursor: pointer;
      font-weight: 600;
      position: relative;
      overflow: hidden;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    button:active {
      transform: translateY(0);
    }

    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    #dash {
      display: none;
      animation: fadeIn 0.5s ease;
    }

    .quick-stats {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 12px;
      padding: 16px;
      background: var(--bg-secondary);
      border-radius: 12px;
      margin-bottom: 24px;
    }

    .quick-stat {
      text-align: center;
      padding: 12px;
      background: var(--card);
      border-radius: 8px;
      border: 1px solid var(--border);
      transition: var(--transition);
      cursor: pointer;
    }

    .quick-stat:hover {
      transform: scale(1.05);
      box-shadow: var(--shadow-md);
    }

    .quick-stat .label {
      font-size: 11px;
      color: var(--muted);
      text-transform: uppercase;
      margin-bottom: 4px;
    }

    .quick-stat .value {
      font-size: 20px;
      font-weight: 700;
      color: var(--accent);
    }

    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 24px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: var(--card);
      padding: 24px;
      border-radius: 20px;
      border: 1px solid var(--border);
      transition: var(--transition);
      position: relative;
      overflow: hidden;
      cursor: pointer;
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 4px;
      background: var(--gradient);
      transform: scaleX(0);
      transition: transform 0.3s ease;
      transform-origin: left;
    }

    .stat-card:hover::before {
      transform: scaleX(1);
    }

    .stat-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-lg);
      background: var(--card-hover);
    }

    .stat-card h3 {
      font-size: 13px;
      color: var(--muted);
      margin-bottom: 12px;
      text-transform: uppercase;
      letter-spacing: 1px;
      font-weight: 600;
    }

    .stat-card .value {
      font-size: 36px;
      font-weight: 800;
      background: var(--gradient);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 8px;
    }

    .stat-card .trend {
      font-size: 13px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .trend.up { color: var(--success); }
    .trend.down { color: var(--danger); }

    .tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 24px;
      padding: 8px;
      background: var(--card);
      border-radius: 16px;
      border: 1px solid var(--border);
      overflow-x: auto;
    }

    .tabs::-webkit-scrollbar {
      height: 6px;
    }

    .tabs::-webkit-scrollbar-track {
      background: transparent;
    }

    .tabs::-webkit-scrollbar-thumb {
      background: var(--border);
      border-radius: 3px;
    }

    .tab-btn {
      background: transparent;
      border: none;
      color: var(--muted);
      padding: 12px 24px;
      cursor: pointer;
      border-radius: 12px;
      transition: var(--transition);
      white-space: nowrap;
      font-weight: 600;
      margin: 0;
    }

    .tab-btn:hover {
      background: var(--accent-light);
      color: var(--text);
    }

    .tab-btn.active {
      background: var(--gradient);
      color: white;
    }

    .tab-content {
      display: none;
      animation: fadeIn 0.5s ease;
    }

    .tab-content.active {
      display: block;
    }

    .toolbar {
      display: flex;
      gap: 12px;
      margin-bottom: 24px;
      flex-wrap: wrap;
      align-items: center;
      padding: 16px;
      background: var(--card);
      border-radius: 16px;
      border: 1px solid var(--border);
    }

    .toolbar input, .toolbar select {
      flex: 1;
      min-width: 200px;
      margin: 0;
    }

    .toolbar button {
      width: auto;
      margin: 0;
      padding: 14px 24px;
    }

    .table-container {
      background: var(--card);
      border-radius: 20px;
      overflow: hidden;
      border: 1px solid var(--border);
      box-shadow: var(--shadow-md);
      overflow-x: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th, td {
      padding: 16px;
      text-align: left;
      border-bottom: 1px solid var(--border);
    }

    th {
      background: var(--bg-secondary);
      font-weight: 700;
      color: var(--muted);
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 1px;
      position: sticky;
      top: 0;
      z-index: 10;
    }

    tbody tr {
      transition: var(--transition);
    }

    tbody tr:hover {
      background: var(--card-hover);
    }

    tbody tr:last-child td {
      border-bottom: none;
    }

    .badge {
      background: var(--accent-light);
      color: var(--accent);
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 700;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .badge.success {
      background: rgba(16, 185, 129, 0.15);
      color: var(--success);
    }

    .badge.warning {
      background: rgba(245, 158, 11, 0.15);
      color: var(--warning);
    }

    .badge.danger {
      background: rgba(239, 68, 68, 0.15);
      color: var(--danger);
    }

    .badge.info {
      background: rgba(59, 130, 246, 0.15);
      color: var(--info);
    }

    .actions {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .btn-sm {
      padding: 8px 16px;
      font-size: 12px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      transition: var(--transition);
      margin: 0;
      white-space: nowrap;
      font-weight: 600;
    }

    .btn-primary {
      background: var(--accent);
      color: white;
    }

    .btn-success {
      background: var(--success);
      color: white;
    }

    .btn-danger {
      background: var(--danger);
      color: white;
    }

    .btn-warning {
      background: var(--warning);
      color: white;
    }

    .btn-sm:hover {
      transform: scale(1.05);
      box-shadow: var(--shadow-md);
    }

    .empty-state {
      text-align: center;
      padding: 80px 20px;
      color: var(--muted);
      font-size: 16px;
    }

    .empty-state::before {
      content: 'üì≠';
      display: block;
      font-size: 48px;
      margin-bottom: 16px;
      opacity: 0.5;
    }

    .toast-container {
      position: fixed;
      top: 24px;
      right: 24px;
      z-index: 2000;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .toast {
      background: var(--card);
      border: 1px solid var(--border);
      border-left: 4px solid var(--success);
      padding: 16px 24px;
      border-radius: 12px;
      box-shadow: var(--shadow-lg);
      min-width: 300px;
      opacity: 0;
      transform: translateX(400px);
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .toast::before {
      content: '‚úÖ';
      font-size: 20px;
    }

    .toast.show {
      opacity: 1;
      transform: translateX(0);
    }

    .toast.error {
      border-left-color: var(--danger);
    }

    .toast.error::before {
      content: '‚ùå';
    }

    .toast.warning {
      border-left-color: var(--warning);
    }

    .toast.warning::before {
      content: '‚ö†Ô∏è';
    }

    .loading {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 60px;
    }

    .spinner {
      border: 3px solid var(--border);
      border-top-color: var(--accent);
      border-radius: 50%;
      width: 48px;
      height: 48px;
      animation: spin 1s linear infinite;
    }

    .chart-container {
      background: var(--card);
      padding: 24px;
      border-radius: 20px;
      border: 1px solid var(--border);
      margin-bottom: 24px;
      transition: var(--transition);
    }

    .chart-container:hover {
      box-shadow: var(--shadow-md);
      transform: translateY(-2px);
    }

    .chart-container h3 {
      margin-bottom: 20px;
      font-size: 18px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .progress-bar {
      width: 100%;
      height: 8px;
      background: var(--border);
      border-radius: 8px;
      overflow: hidden;
      margin: 8px 0;
    }

    .progress-fill {
      height: 100%;
      background: var(--gradient);
      border-radius: 8px;
      transition: width 0.5s ease;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      color: var(--text-secondary);
      font-size: 13px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      margin: 0;
    }

    .modal {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(10px);
      z-index: 1000;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .modal.active {
      display: flex;
      animation: fadeIn 0.3s ease;
    }

    .modal-content {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 24px;
      padding: 32px;
      max-width: 600px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: var(--shadow-lg);
      animation: slideDown 0.3s ease;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }

    .modal-header h3 {
      font-size: 24px;
      font-weight: 700;
    }

    .modal-close {
      background: transparent;
      border: none;
      color: var(--text);
      font-size: 28px;
      cursor: pointer;
      padding: 0;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 8px;
      transition: var(--transition);
    }

    .modal-close:hover {
      background: var(--accent-light);
      color: var(--accent);
    }

    @media (max-width: 768px) {
      .header {
        flex-direction: column;
        gap: 16px;
        text-align: center;
      }
      
      .header-actions {
        flex-wrap: wrap;
        justify-content: center;
      }
      
      .stats {
        grid-template-columns: 1fr;
      }
      
      .toolbar {
        flex-direction: column;
      }
      
      .toolbar input,
      .toolbar select {
        width: 100%;
      }
      
      th, td {
        padding: 12px 8px;
        font-size: 13px;
      }
    }
  </style>
</head>
<body data-theme="dark">

<div class="container">
  <!-- Login -->
  <div id="auth">
    <h2>üöÄ Admin Panel Pro</h2>
    <div>
      <input id="pass" type="password" placeholder="Mot de passe administrateur" autocomplete="current-password">
      <button onclick="App.handleLogin()">Se connecter</button>
    </div>
    <div style="text-align:center;margin-top:20px;color:var(--muted);font-size:12px">
      <p>üîí Connexion s√©curis√©e</p>
      <p>Interface d'administration DROGUA CENTER</p>
    </div>
  </div>

  <!-- Dashboard -->
  <div id="dash">
    <!-- Header -->
    <div class="header">
      <h1>
        <span>üéØ</span>
        <span>DROGUA CENTER</span>
      </h1>
      <div class="header-actions">
        <button id="syncBtn" onclick="App.manualSync()" style="padding:10px 20px;margin:0;background:var(--info)" title="Synchroniser avec la boutique">
          üîÑ Sync
        </button>
        <button id="notifBtn" onclick="App.toggleNotifications()" style="padding:10px;margin:0;background:transparent;color:var(--text)">
          üîî <span id="notifCount" style="background:var(--danger);color:white;padding:2px 6px;border-radius:10px;font-size:10px;display:none">0</span>
        </button>
        <div class="theme-toggle" id="themeToggle" onclick="App.toggleTheme()"></div>
        <button onclick="App.showSettings()" style="padding:10px 20px;margin:0;background:var(--accent)">‚öôÔ∏è Param√®tres</button>
        <button onclick="App.logout()" style="padding:10px 20px;margin:0;background:var(--danger)">üö™ D√©connexion</button>
      </div>
    </div>
    
    <!-- Quick Stats -->
    <div class="quick-stats" id="quickStats">
      <div class="quick-stat">
        <div class="label">Aujourd'hui</div>
        <div class="value" id="todayRevenue">0‚Ç¨</div>
      </div>
      <div class="quick-stat">
        <div class="label">Cette semaine</div>
        <div class="value" id="weekRevenue">0‚Ç¨</div>
      </div>
      <div class="quick-stat">
        <div class="label">Ce mois</div>
        <div class="value" id="monthRevenue">0‚Ç¨</div>
      </div>
      <div class="quick-stat">
        <div class="label">Commandes actives</div>
        <div class="value" id="activeOrders">0</div>
      </div>
      <div class="quick-stat">
        <div class="label">Stock faible</div>
        <div class="value" id="lowStock" style="color:var(--warning)">0</div>
      </div>
      <div class="quick-stat">
        <div class="label">Nouveaux clients</div>
        <div class="value" id="newCustomers">0</div>
      </div>
      <div class="quick-stat" style="background:var(--info);color:white" title="Synchronisation automatique avec la boutique">
        <div class="label" style="color:rgba(255,255,255,0.8)">Boutique</div>
        <div class="value" style="color:white;font-size:16px" id="syncStatus">üîÑ Actif</div>
      </div>
    </div>

    <!-- Main Stats -->
    <div class="stats">
      <div class="stat-card">
        <h3>üí∞ Chiffre d'affaires total</h3>
        <div class="value" id="totalRevenue">0,00 ‚Ç¨</div>
        <div class="trend up">
          <span>‚Üó</span>
          <span>+12% vs mois dernier</span>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" style="width:65%"></div>
        </div>
      </div>
      <div class="stat-card">
        <h3>üì¶ Nombre de commandes</h3>
        <div class="value" id="totalOrders">0</div>
        <div class="trend up">
          <span>‚Üó</span>
          <span>+8 cette semaine</span>
        </div>
      </div>
      <div class="stat-card">
        <h3>üõí Panier moyen</h3>
        <div class="value" id="avgCart">0,00 ‚Ç¨</div>
        <div class="trend">
          <span>‚Üí</span>
          <span>Stable</span>
        </div>
      </div>
      <div class="stat-card">
        <h3>üèÜ Produit le plus vendu</h3>
        <div class="value" style="font-size:24px" id="topProduct">-</div>
        <div style="color:var(--muted);font-size:12px;margin-top:8px" id="topProductSales">0 ventes</div>
      </div>
      <div class="stat-card">
        <h3>üíé Valeur totale du stock</h3>
        <div class="value" id="stockValue">0,00 ‚Ç¨</div>
        <div style="color:var(--muted);font-size:12px;margin-top:8px" id="stockItems">0 articles</div>
      </div>
      <div class="stat-card">
        <h3>‚ö†Ô∏è Alertes stock</h3>
        <div class="value" style="color:var(--warning)" id="stockAlerts">0</div>
        <div id="stockAlertDetails" style="font-size:12px;margin-top:8px">
          <span style="color:var(--danger)">0 ruptures</span> ‚Ä¢ 
          <span style="color:var(--warning)">0 stock bas</span>
        </div>
      </div>
    </div>

    <!-- Tabs -->
    <div class="tabs">
      <button class="tab-btn active" data-tab="dashboard">üìä Tableau de bord</button>
      <button class="tab-btn" data-tab="orders">üì¶ Commandes</button>
      <button class="tab-btn" data-tab="products">üõç Produits</button>
      <button class="tab-btn" data-tab="stock">üìà Stock</button>
      <button class="tab-btn" data-tab="customers">üë• Clients</button>
      <button class="tab-btn" data-tab="finances">üí∞ Finances</button>
      <button class="tab-btn" data-tab="cashier">üí∂ Caisse</button>
      <button class="tab-btn" data-tab="analytics">üìä Analytics</button>
      <button class="tab-btn" data-tab="settings">‚öôÔ∏è Param√®tres</button>
    </div>

    <!-- Dashboard Tab -->
    <div class="tab-content active" id="tab-dashboard">
      <div class="chart-container">
        <h3>üìà √âvolution des ventes (7 derniers jours)</h3>
        <div style="display:flex;gap:8px;align-items:flex-end;height:200px;padding:20px;background:var(--bg-secondary);border-radius:12px">
          <div style="flex:1;background:var(--gradient);height:40%;border-radius:4px 4px 0 0"></div>
          <div style="flex:1;background:var(--gradient);height:60%;border-radius:4px 4px 0 0"></div>
          <div style="flex:1;background:var(--gradient);height:75%;border-radius:4px 4px 0 0"></div>
          <div style="flex:1;background:var(--gradient);height:50%;border-radius:4px 4px 0 0"></div>
          <div style="flex:1;background:var(--gradient);height:85%;border-radius:4px 4px 0 0"></div>
          <div style="flex:1;background:var(--gradient);height:70%;border-radius:4px 4px 0 0"></div>
          <div style="flex:1;background:var(--gradient);height:100%;border-radius:4px 4px 0 0"></div>
        </div>
      </div>

      <div style="display:grid;grid-template-columns:1fr 1fr;gap:24px;margin-top:24px">
        <div class="chart-container">
          <h3>üèÜ Top 5 Produits</h3>
          <div id="topProductsChart" style="padding:20px">
            <!-- Sera rempli dynamiquement -->
          </div>
        </div>
        
        <div class="chart-container">
          <h3>üî¥ Activit√© en temps r√©el</h3>
          <div id="activityFeed" style="max-height:300px;overflow-y:auto">
            <!-- Sera rempli dynamiquement -->
          </div>
        </div>
      </div>
    </div>

    <!-- Orders Tab -->
    <div class="tab-content" id="tab-orders">
      <div class="toolbar">
        <input type="text" id="searchOrders" placeholder="üîç Rechercher une commande..." oninput="App.searchOrders()">
        <select id="filterStatus" onchange="App.filterOrders()">
          <option value="all">Tous les statuts</option>
          <option value="pending">‚è≥ En attente</option>
          <option value="processing">üîÑ En traitement</option>
          <option value="delivered">‚úÖ Livr√©</option>
          <option value="cancelled">‚ùå Annul√©</option>
        </select>
        <button onclick="App.addNewOrder()" style="background:var(--success)">‚ûï Nouvelle commande</button>
        <button onclick="App.exportOrders()">üì• Exporter</button>
      </div>

      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>Date</th>
              <th>Client</th>
              <th>Produits</th>
              <th>Total</th>
              <th>Statut</th>
              <th>Paiement</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="ordersTable">
            <tr><td colspan="8" class="empty-state">Aucune commande</td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Products Tab -->
    <div class="tab-content" id="tab-products">
      <div class="toolbar">
        <input type="text" id="searchProducts" placeholder="üîç Rechercher un produit..." oninput="App.searchProducts()">
        <select id="filterCategory" onchange="App.filterProducts()">
          <option value="all">Toutes cat√©gories</option>
          <option value="blanche">blanche</option>
          <option value="keta">keta</option>
          <option value="mdma">mdma</option>
          <option value="bonbon">bonbon</option>
          <option value="cali">cali</option>
          <option value="fleurs">üåø Fleurs</option>
          <option value="filtr√©">filtr√©</option>
          <option value="resines">üü´ R√©sines</option>
        </select>
        <button onclick="App.addNewProduct()" style="background:var(--success)">‚ûï Nouveau produit</button>
        <button onclick="App.refreshProducts()">üîÑ Actualiser</button>
      </div>

      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>Nom</th>
              <th>Cat√©gorie</th>
              <th>Variants</th>
              <th>Prix Min</th>
              <th>Stock Total</th>
              <th>Statut</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="productsTable">
            <tr><td colspan="8" class="empty-state">Chargement des produits...</td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Stock Tab -->
    <div class="tab-content" id="tab-stock">
      <div class="toolbar">
        <select id="stockProduct" onchange="App.updateVariantOptions()">
          <option value="">S√©lectionner un produit...</option>
        </select>
        <select id="stockVariant" disabled>
          <option value="">S√©lectionner un variant...</option>
        </select>
        <input type="number" id="stockQty" placeholder="Quantit√©" min="0">
        <button onclick="App.addStock()" style="background:var(--success)">‚ûï Ajouter</button>
        <button onclick="App.adjustStock()" style="background:var(--warning)">‚öñÔ∏è Ajuster</button>
      </div>

      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>Produit</th>
              <th>Variant</th>
              <th>Stock</th>
              <th>Prix d'achat</th>
              <th>Prix de vente</th>
              <th>Valeur</th>
              <th>Statut</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="stockTable">
            <tr><td colspan="8" class="empty-state">Chargement du stock...</td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Customers Tab -->
    <div class="tab-content" id="tab-customers">
      <div class="toolbar">
        <input type="text" id="searchCustomers" placeholder="üîç Rechercher un client..." oninput="App.searchCustomers()">
        <select id="filterCustomerType" onchange="App.filterCustomers()">
          <option value="all">Tous les clients</option>
          <option value="vip">‚≠ê VIP</option>
          <option value="regular">üë§ R√©gulier</option>
          <option value="new">üÜï Nouveau</option>
        </select>
        <button onclick="App.addNewCustomer()" style="background:var(--success)">‚ûï Nouveau client</button>
        <button onclick="App.exportCustomers()">üì• Exporter</button>
      </div>

      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>Nom</th>
              <th>Email</th>
              <th>T√©l√©phone</th>
              <th>Commandes</th>
              <th>Total d√©pens√©</th>
              <th>Statut</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="customersTable">
            <tr><td colspan="8" class="empty-state">Chargement des clients...</td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Finances Tab -->
    <div class="tab-content" id="tab-finances">
      <div class="stats">
        <div class="stat-card">
          <h3>üíµ Revenus du mois</h3>
          <div class="value" id="monthlyRevenue">0,00 ‚Ç¨</div>
          <div class="trend up">
            <span>‚Üó</span>
            <span>+15% vs mois dernier</span>
          </div>
        </div>
        <div class="stat-card">
          <h3>üí∏ D√©penses du mois</h3>
          <div class="value" style="color:var(--danger)" id="monthlyExpenses">0,00 ‚Ç¨</div>
          <div class="trend down">
            <span>‚Üò</span>
            <span>-5% vs mois dernier</span>
          </div>
        </div>
        <div class="stat-card">
          <h3>üí∞ B√©n√©fice net</h3>
          <div class="value" id="netProfit">0,00 ‚Ç¨</div>
          <div class="trend up">
            <span>‚Üó</span>
            <span>+22% vs mois dernier</span>
          </div>
        </div>
        <div class="stat-card">
          <h3>üí∂ Caisse actuelle</h3>
          <div class="value" id="currentCash">0,00 ‚Ç¨</div>
          <div style="color:var(--muted);font-size:12px;margin-top:8px" id="cashDetails">
            <span style="color:var(--success)">Entr√©es: 0‚Ç¨</span> ‚Ä¢ 
            <span style="color:var(--danger)">Sorties: 0‚Ç¨</span>
          </div>
        </div>
      </div>

      <!-- Calculateur de rentabilit√© -->
      <div class="chart-container">
        <h3>üßÆ Calculateur de rentabilit√©</h3>
        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px;padding:20px;background:var(--bg-secondary);border-radius:12px">
          <div>
            <label style="display:block;margin-bottom:8px;color:var(--muted);font-size:12px">Produit</label>
            <select id="calcProduct" onchange="App.calculateProfit()">
              <option value="">S√©lectionner...</option>
            </select>
          </div>
          <div>
            <label style="display:block;margin-bottom:8px;color:var(--muted);font-size:12px">Poids (g)</label>
            <input type="number" id="calcWeight" placeholder="Ex: 10" step="0.1" oninput="App.calculateProfit()">
          </div>
          <div>
            <label style="display:block;margin-bottom:8px;color:var(--muted);font-size:12px">Prix d'achat (‚Ç¨/g)</label>
            <input type="number" id="calcBuyPrice" placeholder="Ex: 1.5" step="0.01" oninput="App.calculateProfit()">
          </div>
          <div>
            <label style="display:block;margin-bottom:8px;color:var(--muted);font-size:12px">Prix de vente (‚Ç¨)</label>
            <input type="number" id="calcSellPrice" placeholder="Ex: 50" step="0.01" oninput="App.calculateProfit()">
          </div>
          <div>
            <label style="display:block;margin-bottom:8px;color:var(--muted);font-size:12px">Quantit√© vendue</label>
            <input type="number" id="calcQuantity" placeholder="Ex: 10" value="1" min="1" oninput="App.calculateProfit()">
          </div>
        </div>
        
        <!-- R√©sultats du calcul -->
        <div id="profitResults" style="display:none;margin-top:20px;padding:20px;background:var(--bg-secondary);border-radius:12px">
          <h4 style="margin-bottom:16px;color:var(--accent)">üìä Analyse de rentabilit√©</h4>
          <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:16px">
            <div style="text-align:center;padding:12px;background:var(--card);border-radius:8px">
              <div style="font-size:11px;color:var(--muted);margin-bottom:6px">Co√ªt d'achat</div>
              <div style="font-size:20px;font-weight:700;color:var(--danger)" id="resultCost">0‚Ç¨</div>
            </div>
            <div style="text-align:center;padding:12px;background:var(--card);border-radius:8px">
              <div style="font-size:11px;color:var(--muted);margin-bottom:6px">Prix de vente</div>
              <div style="font-size:20px;font-weight:700;color:var(--accent)" id="resultSell">0‚Ç¨</div>
            </div>
            <div style="text-align:center;padding:12px;background:var(--card);border-radius:8px">
              <div style="font-size:11px;color:var(--muted);margin-bottom:6px">B√©n√©fice unitaire</div>
              <div style="font-size:20px;font-weight:700;color:var(--success)" id="resultUnitProfit">0‚Ç¨</div>
            </div>
            <div style="text-align:center;padding:12px;background:var(--card);border-radius:8px">
              <div style="font-size:11px;color:var(--muted);margin-bottom:6px">Marge %</div>
              <div style="font-size:20px;font-weight:700;color:var(--warning)" id="resultMargin">0%</div>
            </div>
            <div style="text-align:center;padding:12px;background:var(--card);border-radius:8px;border:2px solid var(--success)">
              <div style="font-size:11px;color:var(--muted);margin-bottom:6px">B√©n√©fice total</div>
              <div style="font-size:24px;font-weight:800;color:var(--success)" id="resultTotalProfit">0‚Ç¨</div>
            </div>
            <div style="text-align:center;padding:12px;background:var(--card);border-radius:8px">
              <div style="font-size:11px;color:var(--muted);margin-bottom:6px">CA total</div>
              <div style="font-size:20px;font-weight:700;color:var(--info)" id="resultTotalRevenue">0‚Ç¨</div>
            </div>
          </div>
        </div>
      </div>

      <div class="chart-container">
        <h3>üìä Rentabilit√© par produit</h3>
        <div class="table-container" style="box-shadow:none;border:none">
          <table>
            <thead>
              <tr>
                <th>Produit</th>
                <th>Ventes</th>
                <th>Chiffre d'affaires</th>
                <th>Co√ªt</th>
                <th>B√©n√©fice</th>
                <th>Marge %</th>
              </tr>
            </thead>
            <tbody id="profitTable">
              <tr><td colspan="6" class="empty-state">Calcul en cours...</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Cashier Tab -->
    <div class="tab-content" id="tab-cashier">
      <div class="stats">
        <div class="stat-card" style="background:var(--gradient);color:white">
          <h3 style="color:white">üí∂ CAISSE ACTUELLE</h3>
          <div class="value" style="font-size:48px;color:white;-webkit-text-fill-color:white" id="cashTotal">0,00 ‚Ç¨</div>
          <div style="margin-top:12px;font-size:14px">
            Derni√®re mise √† jour: <span id="cashLastUpdate">Maintenant</span>
          </div>
        </div>
        <div class="stat-card">
          <h3>‚ûï Entr√©es du jour</h3>
          <div class="value" style="color:var(--success)" id="todayIncome">0,00 ‚Ç¨</div>
          <div style="color:var(--muted);font-size:12px;margin-top:8px">
            <span id="todayIncomeCount">0</span> transactions
          </div>
        </div>
        <div class="stat-card">
          <h3>‚ûñ Sorties du jour</h3>
          <div class="value" style="color:var(--danger)" id="todayExpense">0,00 ‚Ç¨</div>
          <div style="color:var(--muted);font-size:12px;margin-top:8px">
            <span id="todayExpenseCount">0</span> transactions
          </div>
        </div>
        <div class="stat-card">
          <h3>üìä Balance du jour</h3>
          <div class="value" id="todayBalance">0,00 ‚Ç¨</div>
          <div class="progress-bar" style="margin-top:12px">
            <div class="progress-fill" id="balanceBar" style="width:50%"></div>
          </div>
        </div>
      </div>

      <!-- Nouvelle transaction -->
      <div class="chart-container">
        <h3>üí∏ Nouvelle transaction</h3>
        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px">
          <div>
            <label style="display:block;margin-bottom:8px;color:var(--muted);font-size:12px">Type</label>
            <select id="transType" onchange="App.updateTransactionForm()">
              <option value="income">‚ûï Entr√©e (Vente)</option>
              <option value="expense">‚ûñ Sortie (Achat/D√©pense)</option>
              <option value="adjustment">‚öñÔ∏è Ajustement</option>
            </select>
          </div>
          <div>
            <label style="display:block;margin-bottom:8px;color:var(--muted);font-size:12px">Montant (‚Ç¨)</label>
            <input type="number" id="transAmount" placeholder="0.00" step="0.01" min="0">
          </div>
          <div>
            <label style="display:block;margin-bottom:8px;color:var(--muted);font-size:12px">Cat√©gorie</label>
            <select id="transCategory">
              <option value="sale">Vente produit</option>
              <option value="purchase">Achat stock</option>
              <option value="expense">Autre d√©pense</option>
              <option value="other">Autre</option>
            </select>
          </div>
          <div>
            <label style="display:block;margin-bottom:8px;color:var(--muted);font-size:12px">Description</label>
            <input type="text" id="transDescription" placeholder="Ex: Vente AMNESIA 5G">
          </div>
        </div>
        <button onclick="App.addTransaction()" style="margin-top:16px;background:var(--success)">üíæ Enregistrer la transaction</button>
      </div>

      <!-- Historique des transactions -->
      <div class="chart-container" style="margin-top:24px">
        <h3>üìú Historique des transactions du jour</h3>
        <div class="table-container" style="box-shadow:none;border:none;max-height:400px;overflow-y:auto">
          <table>
            <thead>
              <tr>
                <th>Heure</th>
                <th>Type</th>
                <th>Description</th>
                <th>Montant</th>
                <th>Caisse apr√®s</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="transactionHistory">
              <tr><td colspan="6" class="empty-state">Aucune transaction aujourd'hui</td></tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Actions rapides -->
      <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:24px;margin-top:24px">
        <div class="chart-container">
          <h3>‚ö° Actions rapides</h3>
          <div style="display:grid;gap:12px">
            <button onclick="App.quickSale(20)" style="background:var(--success);text-align:left;padding:16px">
              üíµ Vente rapide 20‚Ç¨
            </button>
            <button onclick="App.quickSale(50)" style="background:var(--success);text-align:left;padding:16px">
              üíµ Vente rapide 50‚Ç¨
            </button>
            <button onclick="App.quickSale(100)" style="background:var(--success);text-align:left;padding:16px">
              üíµ Vente rapide 100‚Ç¨
            </button>
            <button onclick="App.openCashCount()" style="background:var(--info);text-align:left;padding:16px">
              üî¢ Compter la caisse
            </button>
            <button onclick="App.closeCashRegister()" style="background:var(--warning);text-align:left;padding:16px">
              üîí Cl√¥turer la journ√©e
            </button>
          </div>
        </div>

        <div class="chart-container">
          <h3>üìä R√©sum√© de la semaine</h3>
          <div id="weekSummary" style="padding:20px">
            <div style="margin-bottom:12px">
              <div style="display:flex;justify-content:space-between;margin-bottom:8px">
                <span>Lundi</span>
                <span style="color:var(--success)">+850‚Ç¨</span>
              </div>
              <div class="progress-bar">
                <div class="progress-fill" style="width:85%"></div>
              </div>
            </div>
            <div style="margin-bottom:12px">
              <div style="display:flex;justify-content:space-between;margin-bottom:8px">
                <span>Mardi</span>
                <span style="color:var(--success)">+620‚Ç¨</span>
              </div>
              <div class="progress-bar">
                <div class="progress-fill" style="width:62%"></div>
              </div>
            </div>
            <div style="margin-bottom:12px">
              <div style="display:flex;justify-content:space-between;margin-bottom:8px">
                <span>Mercredi</span>
                <span style="color:var(--success)">+480‚Ç¨</span>
              </div>
              <div class="progress-bar">
                <div class="progress-fill" style="width:48%"></div>
              </div>
            </div>
            <div style="margin-bottom:12px">
              <div style="display:flex;justify-content:space-between;margin-bottom:8px">
                <span>Jeudi</span>
                <span style="color:var(--success)">+730‚Ç¨</span>
              </div>
              <div class="progress-bar">
                <div class="progress-fill" style="width:73%"></div>
              </div>
            </div>
            <div style="margin-bottom:12px">
              <div style="display:flex;justify-content:space-between;margin-bottom:8px">
                <span>Vendredi</span>
                <span style="color:var(--success)">+1000‚Ç¨</span>
              </div>
              <div class="progress-bar">
                <div class="progress-fill" style="width:100%"></div>
              </div>
            </div>
            <div style="margin-top:20px;padding-top:20px;border-top:1px solid var(--border)">
              <div style="display:flex;justify-content:space-between;font-size:18px;font-weight:700">
                <span>Total semaine:</span>
                <span style="color:var(--success)">3,680‚Ç¨</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Analytics Tab -->
    <div class="tab-content" id="tab-analytics">
      <div class="stats">
        <div class="stat-card">
          <h3>üìà Taux de conversion</h3>
          <div class="value">24.5%</div>
          <div class="trend up">
            <span>‚Üó</span>
            <span>+2.3% vs mois dernier</span>
          </div>
        </div>
        <div class="stat-card">
          <h3>üîÑ Taux de r√©tention</h3>
          <div class="value">67%</div>
          <div class="trend up">
            <span>‚Üó</span>
            <span>+5% vs mois dernier</span>
          </div>
        </div>
        <div class="stat-card">
          <h3>‚≠ê Note moyenne</h3>
          <div class="value">4.7/5</div>
          <div style="color:var(--warning);margin-top:8px">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
        </div>
      </div>

      <div style="display:grid;grid-template-columns:1fr 1fr;gap:24px;margin-top:24px">
        <div class="chart-container">
          <h3>üìä Ventes par cat√©gorie</h3>
          <div id="categoryChart" style="padding:20px">
            <!-- Sera rempli dynamiquement -->
          </div>
        </div>

        <div class="chart-container">
          <h3>üåç Ventes par zone</h3>
          <div id="zoneChart" style="padding:20px">
            <!-- Sera rempli dynamiquement -->
          </div>
        </div>
      </div>
    </div>

    <!-- Settings Tab -->
    <div class="tab-content" id="tab-settings">
      <div class="chart-container">
        <h3>‚öôÔ∏è Param√®tres g√©n√©raux</h3>
        <div class="form-group">
          <label>Nom de la boutique</label>
          <input type="text" id="shopName" value="DROGUA CENTER">
        </div>
        <div class="form-group">
          <label>Email de contact</label>
          <input type="email" id="shopEmail" value="contact@drogua.center">
        </div>
        <div class="form-group">
          <label>T√©l√©phone</label>
          <input type="tel" id="shopPhone" value="06 XX XX XX XX">
        </div>
        <button onclick="App.saveSettings()">üíæ Sauvegarder les param√®tres</button>
      </div>

      <div class="chart-container" style="margin-top:24px">
        <h3>üîí S√©curit√©</h3>
        <div class="form-group">
          <label>Ancien mot de passe</label>
          <input type="password" id="oldPassword">
        </div>
        <div class="form-group">
          <label>Nouveau mot de passe</label>
          <input type="password" id="newPassword">
        </div>
        <div class="form-group">
          <label>Confirmer le mot de passe</label>
          <input type="password" id="confirmPassword">
        </div>
        <button onclick="App.updatePassword()">üîê Modifier le mot de passe</button>
      </div>

      <div class="chart-container" style="margin-top:24px">
        <h3>üíæ Donn√©es & Sauvegarde</h3>
        <button onclick="App.exportAllData()" style="margin-right:12px">üì• Exporter toutes les donn√©es</button>
        <button onclick="App.importData()" style="background:var(--warning);margin-right:12px">üì§ Importer des donn√©es</button>
        <button onclick="App.clearAllData()" style="background:var(--danger)">üóëÔ∏è Effacer toutes les donn√©es</button>
      </div>
      
      <div class="chart-container" style="margin-top:24px">
        <h3>üîÑ Synchronisation boutique</h3>
        <p style="color:var(--muted);margin-bottom:16px">
          La synchronisation automatique v√©rifie les nouvelles commandes de la boutique toutes les 5 secondes.
        </p>
        <div style="padding:16px;background:var(--bg-secondary);border-radius:12px;margin-bottom:16px">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
            <span>Statut de la synchronisation:</span>
            <span style="color:var(--success);font-weight:700">‚úÖ Active</span>
          </div>
          <div style="display:flex;justify-content:space-between;align-items:center">
            <span>Derni√®re synchronisation:</span>
            <span id="lastSyncTime">Maintenant</span>
          </div>
        </div>
        <button onclick="App.manualSync()">üîÑ Synchroniser maintenant</button>
      </div>
    </div>
  </div>
</div>

<!-- Toast Container -->
<div class="toast-container" id="toastContainer"></div>

<!-- Modal -->
<div class="modal" id="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3 id="modalTitle">Titre</h3>
      <button class="modal-close" onclick="App.closeModal()">‚úï</button>
    </div>
    <div id="modalBody">
      <!-- Contenu dynamique -->
    </div>
  </div>
</div>

<script>
// Application principale avec namespace
const App = {
  // Configuration
  config: {
    PASSWORD_HASH: btoa('gangstaforlife12'),
    STORAGE_KEYS: {
      AUTH: 'admin_auth',
      THEME: 'admin_theme',
      DATA: 'admin_data'
    },
    SYNC_INTERVAL: 5000 // 5 secondes
  },

  // √âtat de l'application
  state: {
    isLoggedIn: false,
    currentTab: 'dashboard',
    loginAttempts: 0,
    maxAttempts: 5,
    lockoutTime: null,
    notifications: [],
    syncInterval: null,
    lastSyncTime: null,
    cash: {
      total: 2500,
      transactions: [],
      dailyIncome: 0,
      dailyExpense: 0
    },
    data: {
      orders: [],
      products: [],
      customers: [],
      stock: [],
      finances: {}
    }
  },

  // Catalogue complet des produits
  productCatalog: [
    { id: 1, name: 'AMNESIA', category: 'fleurs', buyPrice: 2.8, variants: {
      '3.33G': { price: 20, stock: 50 },
      '5G': { price: 30, stock: 45 },
      '10G': { price: 60, stock: 30 },
      '50G': { price: 250, stock: 10 },
      '100G': { price: 450, stock: 5 }
    }},
    { id: 2, name: 'EL JEFE', category: 'blanche', buyPrice: 17.5, variants: {
      '0.5G': { price: 30, stock: 20 },
      '1G': { price: 50, stock: 15 },
      '2G': { price: 100, stock: 10 },
      '5G': { price: 250, stock: 5 },
      '10G': { price: 430, stock: 3 }
    }},
    { id: 3, name: 'DEMBELE', category: 'resines', buyPrice: 2.7, variants: {
      '3.5G': { price: 20, stock: 60 },
      '5G': { price: 30, stock: 50 },
      '10G': { price: 50, stock: 40 },
      '50G': { price: 190, stock: 15 },
      '100G': { price: 370, stock: 8 }
    }},
    { id: 4, name: 'LEMON X GELATO', category: 'cali', buyPrice: 5.3, variants: {
      '1.66G': { price: 20, stock: 25 },
      '3.5G': { price: 40, stock: 20 },
      '5G': { price: 60, stock: 15 },
      '10G': { price: 110, stock: 10 }
    }},
    { id: 5, name: 'GEORGIA PIE', category: 'cali', buyPrice: 5.3, variants: {
      '1.66G': { price: 20, stock: 25 },
      '3.5G': { price: 40, stock: 20 },
      '5G': { price: 60, stock: 15 },
      '10G': { price: 110, stock: 10 }
    }},
    { id: 6, name: 'NEEDLES KETA', category: 'keta', buyPrice: 3.9, variants: {
      '1G': { price: 20, stock: 30 },
      '2G': { price: 40, stock: 25 },
      '3G': { price: 50, stock: 20 },
      '5G': { price: 80, stock: 15 },
      '10G': { price: 150, stock: 10 }
    }},
    { id: 7, name: 'CHAMPAGNE', category: 'mdma', buyPrice: 3.9, variants: {
      '1G': { price: 20, stock: 35 },
      '2G': { price: 40, stock: 30 },
      '3G': { price: 50, stock: 25 },
      '5G': { price: 80, stock: 20 },
      '10G': { price: 150, stock: 12 }
    }},
    { id: 8, name: 'SKITTLEZ CAKE 120u', category: 'filtr√©', buyPrice: 3, variants: {
      '2.5G': { price: 20, stock: 40 },
      '5G': { price: 40, stock: 35 },
      '10G': { price: 70, stock: 25 },
      '50G': { price: 290, stock: 8 }
    }},
    { id: 9, name: 'PISTACCHIO 73u', category: 'filtr√©', buyPrice: 3, variants: {
      '3G': { price: 20, stock: 0 },
      '5G': { price: 50, stock: 0 },
      '10G': { price: 90, stock: 0 },
      '50G': { price: 250, stock: 0 }
    }},
    { id: 10, name: 'FRESH FROZEN', category: 'filtr√©', buyPrice: 8, variants: {
      '1.1G': { price: 20, stock: 18 },
      '2.3G': { price: 40, stock: 15 },
      '3.5G': { price: 50, stock: 12 },
      '5G': { price: 80, stock: 8 },
      '10G': { price: 160, stock: 5 }
    }},
    { id: 11, name: 'DOMINO 280mg', category: 'bonbon', buyPrice: 1.5, variants: {
      '3 unit√©s': { price: 20, stock: 50 },
      '10 unit√©s': { price: 60, stock: 30 },
      '50 unit√©s': { price: 150, stock: 10 }
    }},
    { id: 12, name: 'PURPLE HAZE', category: 'fleurs', buyPrice: 2.7, variants: {
      '3.33G': { price: 20, stock: 45 },
      '5G': { price: 30, stock: 40 },
      '10G': { price: 60, stock: 35 },
      '50G': { price: 250, stock: 12 },
      '100G': { price: 480, stock: 6 }
    }}
  ],

  // Donn√©es de d√©monstration
  demoData: {
    orders: [],
    customers: [
      {id: 1, name: 'Jean Dupont', email: 'jean@email.com', phone: '06 12 34 56 78', orders: 12, totalSpent: 1450, status: 'vip'},
      {id: 2, name: 'Marie Martin', email: 'marie@email.com', phone: '06 98 76 54 32', orders: 5, totalSpent: 425, status: 'regular'},
      {id: 3, name: 'Paul Durand', email: 'paul@email.com', phone: '07 11 22 33 44', orders: 2, totalSpent: 150, status: 'new'}
    ]
  },

  // Initialisation
  init() {
    if (localStorage.getItem(this.config.STORAGE_KEYS.AUTH) === 'true') {
      this.showDashboard();
      this.startAutoSync();
    }

    const savedTheme = localStorage.getItem(this.config.STORAGE_KEYS.THEME) || 'dark';
    document.body.setAttribute('data-theme', savedTheme);
    const toggle = document.getElementById('themeToggle');
    if (toggle && savedTheme === 'light') {
      toggle.classList.add('light');
    }

    this.initEvents();
    this.loadData();
    this.syncShopOrders();
    
    window.addEventListener('storage', (e) => {
      if (e.key === 'shop_orders' || e.key === 'cart') {
        this.syncShopOrders();
      }
    });
  },

  initEvents() {
    document.getElementById('pass')?.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') this.handleLogin();
    });

    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.addEventListener('click', (e) => this.switchTab(e.target.dataset.tab));
    });
  },

  handleLogin() {
    if (this.state.lockoutTime && Date.now() < this.state.lockoutTime) {
      const remainingTime = Math.ceil((this.state.lockoutTime - Date.now()) / 60000);
      this.showToast(`Compte verrouill√©. R√©essayez dans ${remainingTime} minute(s)`, 'error');
      return;
    }

    const password = document.getElementById('pass').value;
    
    if (btoa(password) === this.config.PASSWORD_HASH) {
      this.state.loginAttempts = 0;
      this.state.lockoutTime = null;
      localStorage.setItem(this.config.STORAGE_KEYS.AUTH, 'true');
      this.showDashboard();
      this.showToast('Connexion r√©ussie !', 'success');
      this.startAutoSync();
    } else {
      this.state.loginAttempts++;
      
      if (this.state.loginAttempts >= this.state.maxAttempts) {
        this.state.lockoutTime = Date.now() + (5 * 60 * 1000);
        this.showToast('Trop de tentatives. Compte verrouill√© pour 5 minutes', 'error');
      } else {
        const remaining = this.state.maxAttempts - this.state.loginAttempts;
        this.showToast(`Mot de passe incorrect. ${remaining} tentative(s) restante(s)`, 'error');
      }
      
      document.getElementById('pass').value = '';
    }
  },

  logout() {
    if (confirm('√ätes-vous s√ªr de vouloir vous d√©connecter ?')) {
      this.stopAutoSync();
      localStorage.removeItem(this.config.STORAGE_KEYS.AUTH);
      location.reload();
    }
  },

  showDashboard() {
    document.getElementById('auth').style.display = 'none';
    document.getElementById('dash').style.display = 'block';
    this.state.isLoggedIn = true;
    this.loadDashboard();
  },

  // === SYNCHRONISATION AVEC LA BOUTIQUE ===
  syncShopOrders() {
    try {
      const shopOrders = JSON.parse(localStorage.getItem('shop_orders') || '[]');
      
      if (shopOrders.length === 0) return;
      
      const existingOrderIds = this.state.data.orders.map(o => o.shopOrderId || o.id);
      const newOrders = shopOrders.filter(order => !existingOrderIds.includes(order.id));
      
      if (newOrders.length > 0) {
        newOrders.forEach(shopOrder => {
          const adminOrder = {
            id: Math.max(...this.state.data.orders.map(o => o.id), 0) + 1,
            shopOrderId: shopOrder.id,
            date: new Date(shopOrder.timestamp).toLocaleDateString('fr-FR'),
            customer: shopOrder.name || 'Client',
            products: this.formatOrderProducts(shopOrder.items),
            total: shopOrder.total,
            status: 'pending',
            payment: shopOrder.paymentMethod || 'Esp√®ces',
            email: shopOrder.email || '',
            phone: shopOrder.phone || '',
            deliveryAddress: shopOrder.deliveryAddress || '',
            deliveryType: shopOrder.deliveryType || ''
          };
          
          this.state.data.orders.unshift(adminOrder);
          
          if (shopOrder.paymentMethod === 'Esp√®ces') {
            this.state.cash.total += shopOrder.total;
            this.state.cash.transactions.push({
              id: Date.now() + Math.random(),
              date: new Date().toISOString(),
              type: 'income',
              amount: shopOrder.total,
              category: 'sale',
              description: `Commande #${shopOrder.id} - ${shopOrder.name}`,
              balanceAfter: this.state.cash.total
            });
          }
          
          this.updateStockFromOrder(shopOrder.items);
        });
        
        this.saveData();
        this.saveCashData();
        
        this.showNotification(
          `üéâ ${newOrders.length} nouvelle${newOrders.length > 1 ? 's' : ''} commande${newOrders.length > 1 ? 's' : ''} !`,
          'success'
        );
        
        if (this.state.isLoggedIn) {
          this.loadOrders();
          this.updateStats();
          this.updateQuickStats();
          this.loadCashier();
          this.updateActivityFeed();
        }
        
        this.updateNotificationBadge(newOrders.length);
      }
      
      this.state.lastSyncTime = new Date();
      const lastSyncEl = document.getElementById('lastSyncTime');
      if (lastSyncEl) {
        lastSyncEl.textContent = '√Ä l\'instant';
      }
    } catch (error) {
      console.error('Erreur de synchronisation:', error);
    }
  },

  formatOrderProducts(items) {
    if (!items || items.length === 0) return 'Produits non sp√©cifi√©s';
    
    return items.map(item => {
      const variantText = item.variant && item.variant !== 'default' ? ` ${item.variant}` : '';
      return `${item.name}${variantText} x${item.quantity}`;
    }).join(', ');
  },

  updateStockFromOrder(items) {
    if (!items || items.length === 0) return;
    
    items.forEach(item => {
      const product = this.productCatalog.find(p => 
        p.name.toLowerCase() === item.name.toLowerCase()
      );
      
      if (product && item.variant && product.variants[item.variant]) {
        product.variants[item.variant].stock -= item.quantity;
        if (product.variants[item.variant].stock < 0) {
          product.variants[item.variant].stock = 0;
        }
      }
    });
    
    this.saveData();
  },

  updateNotificationBadge(count) {
    const badge = document.getElementById('notifCount');
    if (badge) {
      const currentCount = parseInt(badge.textContent) || 0;
      const newCount = currentCount + count;
      badge.textContent = newCount;
      badge.style.display = newCount > 0 ? 'inline-block' : 'none';
    }
  },

  showNotification(message, type = 'success') {
    this.showToast(message, type);
    this.playNotificationSound();
    
    this.state.notifications.unshift({
      id: Date.now(),
      message: message,
      type: type,
      timestamp: new Date().toISOString(),
      read: false
    });
    
    if (this.state.notifications.length > 50) {
      this.state.notifications = this.state.notifications.slice(0, 50);
    }
  },

  playNotificationSound() {
    try {
      const audioContext = new (window.AudioContext || window.webkitAudioContext)();
      const oscillator = audioContext.createOscillator();
      const gainNode = audioContext.createGain();
      
      oscillator.connect(gainNode);
      gainNode.connect(audioContext.destination);
      
      oscillator.frequency.value = 800;
      oscillator.type = 'sine';
      
      gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
      gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
      
      oscillator.start(audioContext.currentTime);
      oscillator.stop(audioContext.currentTime + 0.3);
    } catch (e) {
      // Ignorer les erreurs de son
    }
  },

  startAutoSync() {
    this.syncInterval = setInterval(() => {
      this.syncShopOrders();
    }, this.config.SYNC_INTERVAL);
  },

  stopAutoSync() {
    if (this.syncInterval) {
      clearInterval(this.syncInterval);
    }
  },

  manualSync() {
    const btn = document.getElementById('syncBtn');
    if (btn) {
      btn.innerHTML = 'üîÑ <div class="spinner" style="width:16px;height:16px;border-width:2px;display:inline-block;vertical-align:middle;margin-left:4px"></div>';
      btn.disabled = true;
    }
    
    this.syncShopOrders();
    
    setTimeout(() => {
      if (btn) {
        btn.innerHTML = '‚úÖ Sync';
        setTimeout(() => {
          btn.innerHTML = 'üîÑ Sync';
          btn.disabled = false;
        }, 1500);
      }
    }, 500);
  },

  loadDashboard() {
    this.updateStats();
    this.updateQuickStats();
    this.loadOrders();
    this.loadProducts();
    this.loadStock();
    this.loadCustomers();
    this.loadFinances();
    this.loadCashier();
    this.loadAnalytics();
    this.updateActivityFeed();
    this.updateTopProducts();
    this.initCalculator();
  },

  updateStats() {
    const orders = this.state.data.orders;
    const totalRevenue = orders.reduce((sum, order) => sum + order.total, 0);
    
    document.getElementById('totalRevenue').textContent = this.formatCurrency(totalRevenue);
    document.getElementById('totalOrders').textContent = orders.length;
    document.getElementById('avgCart').textContent = this.formatCurrency(orders.length ? totalRevenue / orders.length : 0);
    document.getElementById('topProduct').textContent = 'AMNESIA';
    document.getElementById('topProductSales').textContent = '35 ventes ce mois';
    
    let stockValue = 0;
    let stockItems = 0;
    let lowStock = 0;
    let outOfStock = 0;
    
    this.productCatalog.forEach(product => {
      Object.values(product.variants).forEach(variant => {
        stockItems += variant.stock;
        stockValue += variant.stock * variant.price;
        if (variant.stock === 0) outOfStock++;
        else if (variant.stock < 10) lowStock++;
      });
    });
    
    document.getElementById('stockValue').textContent = this.formatCurrency(stockValue);
    document.getElementById('stockItems').textContent = stockItems + ' articles';
    document.getElementById('stockAlerts').textContent = lowStock + outOfStock;
    document.getElementById('stockAlertDetails').innerHTML = 
      `<span style="color:var(--danger)">${outOfStock} ruptures</span> ‚Ä¢ <span style="color:var(--warning)">${lowStock} stock bas</span>`;
  },

  updateQuickStats() {
    const today = new Date();
    const orders = this.state.data.orders;
    
    const todayRevenue = orders
      .filter(o => new Date(o.date).toDateString() === today.toDateString())
      .reduce((sum, o) => sum + o.total, 0);
    
    document.getElementById('todayRevenue').textContent = this.formatCurrency(todayRevenue);
    document.getElementById('weekRevenue').textContent = this.formatCurrency(2340);
    document.getElementById('monthRevenue').textContent = this.formatCurrency(8750);
    document.getElementById('activeOrders').textContent = orders.filter(o => o.status === 'pending' || o.status === 'processing').length;
    
    let lowStockCount = 0;
    this.productCatalog.forEach(product => {
      Object.values(product.variants).forEach(variant => {
        if (variant.stock > 0 && variant.stock < 10) lowStockCount++;
      });
    });
    
    document.getElementById('lowStock').textContent = lowStockCount;
    document.getElementById('newCustomers').textContent = this.state.data.customers.filter(c => c.status === 'new').length;
  },

  switchTab(tabName) {
    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.classList.toggle('active', btn.dataset.tab === tabName);
    });

    document.querySelectorAll('.tab-content').forEach(content => {
      content.classList.toggle('active', content.id === `tab-${tabName}`);
    });

    this.state.currentTab = tabName;
  },

  loadData() {
    const savedData = localStorage.getItem(this.config.STORAGE_KEYS.DATA);
    if (savedData) {
      try {
        const parsed = JSON.parse(savedData);
        this.state.data = parsed;
        
        if (parsed.cash) {
          this.state.cash = parsed.cash;
        }
        
        if (parsed.products && parsed.products.length > 0) {
          this.productCatalog = parsed.products;
        }
      } catch (e) {
        this.state.data.orders = this.demoData.orders;
        this.state.data.customers = this.demoData.customers;
        this.state.data.products = this.productCatalog;
      }
    } else {
      this.state.data.orders = this.demoData.orders;
      this.state.data.customers = this.demoData.customers;
      this.state.data.products = this.productCatalog;
    }
    
    const savedCash = localStorage.getItem('cash_data');
    if (savedCash) {
      try {
        this.state.cash = JSON.parse(savedCash);
      } catch (e) {
        console.log('Erreur chargement caisse');
      }
    }
  },

  saveData() {
    this.state.data.products = this.productCatalog;
    localStorage.setItem(this.config.STORAGE_KEYS.DATA, JSON.stringify(this.state.data));
  },

  loadOrders() {
    const tbody = document.getElementById('ordersTable');
    const orders = this.state.data.orders;

    if (orders.length === 0) {
      tbody.innerHTML = '<tr><td colspan="8" class="empty-state">Aucune commande</td></tr>';
      return;
    }

    tbody.innerHTML = orders.map(order => `
      <tr>
        <td><strong>#${order.id}</strong></td>
        <td>${order.date}</td>
        <td>${order.customer}</td>
        <td>${order.products}</td>
        <td><strong>${this.formatCurrency(order.total)}</strong></td>
        <td>${this.getStatusBadge(order.status)}</td>
        <td><span class="badge">${order.payment}</span></td>
        <td class="actions">
          <button class="btn-sm btn-primary" onclick="App.viewOrder(${order.id})">üëÅÔ∏è</button>
          <button class="btn-sm btn-success" onclick="App.editOrder(${order.id})">‚úèÔ∏è</button>
          <button class="btn-sm btn-danger" onclick="App.deleteOrder(${order.id})">üóëÔ∏è</button>
        </td>
      </tr>
    `).join('');
  },

  loadProducts() {
    const tbody = document.getElementById('productsTable');
    const products = this.productCatalog;
    
    const stockProductSelect = document.getElementById('stockProduct');
    if (stockProductSelect) {
      stockProductSelect.innerHTML = '<option value="">S√©lectionner un produit...</option>' +
        products.map(p => `<option value="${p.id}">${p.name}</option>`).join('');
    }

    tbody.innerHTML = products.map(product => {
      const variants = Object.keys(product.variants).length;
      const prices = Object.values(product.variants).map(v => v.price);
      const minPrice = Math.min(...prices);
      const totalStock = Object.values(product.variants).reduce((sum, v) => sum + v.stock, 0);
      
      let status = 'active';
      if (totalStock === 0) status = 'out';
      else if (totalStock < 20) status = 'low';
      
      return `
        <tr>
          <td><strong>#${product.id}</strong></td>
          <td><strong>${product.name}</strong></td>
          <td><span class="badge">${this.getCategoryBadge(product.category)}</span></td>
          <td>${variants} variants</td>
          <td>${this.formatCurrency(minPrice)}</td>
          <td>${totalStock} unit√©s</td>
          <td>${this.getStockBadge(status)}</td>
          <td class="actions">
            <button class="btn-sm btn-primary" onclick="App.editProduct(${product.id})">‚úèÔ∏è</button>
            <button class="btn-sm btn-success" onclick="App.viewProductStock(${product.id})">üìä</button>
            <button class="btn-sm btn-danger" onclick="App.deleteProduct(${product.id})">üóëÔ∏è</button>
          </td>
        </tr>
      `;
    }).join('');
  },

  loadStock() {
    const tbody = document.getElementById('stockTable');
    let stockRows = [];
    
    this.productCatalog.forEach(product => {
      Object.entries(product.variants).forEach(([variant, data]) => {
        const buyTotal = product.buyPrice * parseFloat(variant);
        const profit = data.price - buyTotal;
        const margin = ((profit / data.price) * 100).toFixed(1);
        
        let status = 'ok';
        if (data.stock === 0) status = 'out';
        else if (data.stock < 10) status = 'low';
        
        stockRows.push(`
          <tr>
            <td><strong>${product.name}</strong></td>
            <td>${variant}</td>
            <td><strong style="color:var(--accent)">${data.stock}</strong></td>
            <td>${this.formatCurrency(buyTotal)}</td>
            <td>${this.formatCurrency(data.price)}</td>
            <td>${this.formatCurrency(data.stock * data.price)}</td>
            <td>${this.getStockBadge(status)}</td>
            <td class="actions">
              <button class="btn-sm btn-success" onclick="App.quickAddStock('${product.name}', '${variant}')">‚ûï</button>
              <button class="btn-sm btn-warning" onclick="App.quickAdjustStock('${product.name}', '${variant}')">‚öñÔ∏è</button>
            </td>
          </tr>
        `);
      });
    });
    
    tbody.innerHTML = stockRows.join('');
  },

  loadCustomers() {
    const tbody = document.getElementById('customersTable');
    const customers = this.state.data.customers;

    if (customers.length === 0) {
      tbody.innerHTML = '<tr><td colspan="8" class="empty-state">Aucun client</td></tr>';
      return;
    }

    tbody.innerHTML = customers.map(customer => `
      <tr>
        <td><strong>#${customer.id}</strong></td>
        <td><strong>${customer.name}</strong></td>
        <td>${customer.email}</td>
        <td>${customer.phone}</td>
        <td>${customer.orders} commandes</td>
        <td><strong>${this.formatCurrency(customer.totalSpent)}</strong></td>
        <td>${this.getCustomerBadge(customer.status)}</td>
        <td class="actions">
          <button class="btn-sm btn-primary" onclick="App.viewCustomer(${customer.id})">üëÅÔ∏è</button>
          <button class="btn-sm btn-success" onclick="App.sendMessage(${customer.id})">üí¨</button>
          <button class="btn-sm btn-danger" onclick="App.deleteCustomer(${customer.id})">üóëÔ∏è</button>
        </td>
      </tr>
    `).join('');
  },

  loadFinances() {
    const orders = this.state.data.orders;
    const revenue = orders.reduce((sum, o) => sum + o.total, 0);
    const expenses = revenue * 0.35;
    const profit = revenue - expenses;
    
    document.getElementById('monthlyRevenue').textContent = this.formatCurrency(revenue);
    document.getElementById('monthlyExpenses').textContent = this.formatCurrency(expenses);
    document.getElementById('netProfit').textContent = this.formatCurrency(profit);
    
    document.getElementById('currentCash').textContent = this.formatCurrency(this.state.cash.total);
    const today = new Date().toDateString();
    const todayTransactions = this.state.cash.transactions.filter(t => 
      new Date(t.date).toDateString() === today
    );
    
    const todayIncome = todayTransactions
      .filter(t => t.type === 'income')
      .reduce((sum, t) => sum + t.amount, 0);
    
    const todayExpense = todayTransactions
      .filter(t => t.type === 'expense')
      .reduce((sum, t) => sum + t.amount, 0);
    
    document.getElementById('cashDetails').innerHTML = 
      `<span style="color:var(--success)">Entr√©es: ${this.formatCurrency(todayIncome)}</span> ‚Ä¢ <span style="color:var(--danger)">Sorties: ${this.formatCurrency(todayExpense)}</span>`;
    
    this.initCalculator();
    
    const tbody = document.getElementById('profitTable');
    const profitData = [
      {product: 'AMNESIA', sales: 35, revenue: 1750, cost: 420, profit: 1330, margin: 76},
      {product: 'EL JEFE', sales: 28, revenue: 2800, cost: 980, profit: 1820, margin: 65},
      {product: 'NEEDLES KETA', sales: 22, revenue: 1100, cost: 352, profit: 748, margin: 68},
      {product: 'DEMBELE', sales: 30, revenue: 900, cost: 165, profit: 735, margin: 82},
      {product: 'SKITTLEZ CAKE', sales: 18, revenue: 720, cost: 180, profit: 540, margin: 75}
    ];
    
    tbody.innerHTML = profitData.map(item => `
      <tr>
        <td><strong>${item.product}</strong></td>
        <td>${item.sales}</td>
        <td>${this.formatCurrency(item.revenue)}</td>
        <td style="color:var(--danger)">${this.formatCurrency(item.cost)}</td>
        <td style="color:var(--success)">${this.formatCurrency(item.profit)}</td>
        <td><span class="badge ${item.margin >= 70 ? 'success' : 'warning'}">${item.margin}%</span></td>
      </tr>
    `).join('');
  },

  loadAnalytics() {
    const categoryChart = document.getElementById('categoryChart');
    if (categoryChart) {
      categoryChart.innerHTML = `
        <div style="margin-bottom:12px">
          <div style="display:flex;justify-content:space-between;margin-bottom:8px">
            <span>üåø Fleurs</span>
            <span style="color:var(--accent)">45%</span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" style="width:45%"></div>
          </div>
        </div>
        <div style="margin-bottom:12px">
          <div style="display:flex;justify-content:space-between;margin-bottom:8px">
            <span>üü´ R√©sines</span>
            <span style="color:var(--accent)">40%</span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" style="width:40%"></div>
          </div>
        </div>
        <div>
          <div style="display:flex;justify-content:space-between;margin-bottom:8px">
            <span>üç™ Edibles</span>
            <span style="color:var(--accent)">15%</span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" style="width:15%"></div>
          </div>
        </div>
      `;
    }
    
    const zoneChart = document.getElementById('zoneChart');
    if (zoneChart) {
      zoneChart.innerHTML = `
        <div style="margin-bottom:12px">
          <div style="display:flex;justify-content:space-between;margin-bottom:8px">
            <span>üìç Millau Centre</span>
            <span style="color:var(--accent)">60%</span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" style="width:60%"></div>
          </div>
        </div>
        <div style="margin-bottom:12px">
          <div style="display:flex;justify-content:space-between;margin-bottom:8px">
            <span>üìç P√©riph√©rie</span>
            <span style="color:var(--accent)">25%</span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" style="width:25%"></div>
          </div>
        </div>
        <div>
          <div style="display:flex;justify-content:space-between;margin-bottom:8px">
            <span>üìç Ext√©rieur</span>
            <span style="color:var(--accent)">15%</span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" style="width:15%"></div>
          </div>
        </div>
      `;
    }
  },

  updateActivityFeed() {
    const feed = document.getElementById('activityFeed');
    if (!feed) return;
    
    const activities = [];
    
    const recentOrders = this.state.data.orders.slice(0, 5);
    recentOrders.forEach(order => {
      const timeAgo = this.getTimeAgo(order.date);
      activities.push({
        text: `Nouvelle commande #${order.id} - ${order.customer}`,
        time: timeAgo,
        icon: 'üì¶',
        type: 'order'
      });
    });
    
    let lowStockCount = 0;
    this.productCatalog.forEach(product => {
      Object.entries(product.variants).forEach(([variant, data]) => {
        if (data.stock > 0 && data.stock < 10 && lowStockCount < 3) {
          activities.push({
            text: `Stock bas: ${product.name} ${variant} (${data.stock} restants)`,
            time: 'Stock',
            icon: '‚ö†Ô∏è',
            type: 'alert'
          });
          lowStockCount++;
        }
      });
    });
    
    const recentCashTransactions = this.state.cash.transactions.slice(-3).reverse();
    recentCashTransactions.forEach(trans => {
      const timeAgo = this.getTimeAgo(trans.date);
      activities.push({
        text: trans.description || `Transaction ${trans.type}`,
        time: timeAgo,
        icon: trans.type === 'income' ? 'üí∞' : 'üí∏',
        type: 'cash'
      });
    });
    
    const sortedActivities = activities
      .sort((a, b) => {
        const priority = { order: 0, alert: 1, cash: 2 };
        return priority[a.type] - priority[b.type];
      })
      .slice(0, 10);
    
    if (sortedActivities.length === 0) {
      feed.innerHTML = '<div class="empty-state">Aucune activit√© r√©cente</div>';
      return;
    }
    
    feed.innerHTML = sortedActivities.map(activity => `
      <div style="padding:12px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;transition:var(--transition);cursor:pointer" onmouseover="this.style.background='var(--card-hover)'" onmouseout="this.style.background='transparent'">
        <div>
          <div style="font-weight:600;font-size:13px">${activity.text}</div>
          <div style="font-size:11px;color:var(--muted);margin-top:4px">${activity.time}</div>
        </div>
        <span style="font-size:20px">${activity.icon}</span>
      </div>
    `).join('');
  },

  getTimeAgo(dateString) {
    try {
      let date;
      if (dateString.includes('/')) {
        const parts = dateString.split('/');
        date = new Date(parts[2], parts[1] - 1, parts[0]);
      } else {
        date = new Date(dateString);
      }
      
      const now = new Date();
      const diff = now - date;
      
      if (diff < 0) return '√Ä venir';
      if (diff < 60000) return '√Ä l\'instant';
      if (diff < 3600000) return `Il y a ${Math.floor(diff / 60000)} min`;
      if (diff < 86400000) return `Il y a ${Math.floor(diff / 3600000)}h`;
      if (diff < 172800000) return 'Hier';
      if (diff < 604800000) return `Il y a ${Math.floor(diff / 86400000)} jours`;
      return dateString;
    } catch (e) {
      return dateString;
    }
  },

  updateTopProducts() {
    const topProducts = document.getElementById('topProductsChart');
    if (topProducts) {
      const products = [
        {name: 'AMNESIA', sales: 35},
        {name: 'EL JEFE', sales: 28},
        {name: 'NEEDLES KETA', sales: 22},
        {name: 'SKITTLEZ CAKE', sales: 18},
        {name: 'DEMBELE', sales: 15}
      ];
      
      topProducts.innerHTML = products.map((product, index) => `
        <div style="margin-bottom:16px">
          <div style="display:flex;justify-content:space-between;margin-bottom:8px">
            <span>${index + 1}. ${product.name}</span>
            <span style="color:var(--accent)">${product.sales} ventes</span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" style="width:${(product.sales / products[0].sales) * 100}%"></div>
          </div>
        </div>
      `).join('');
    }
  },

  updateVariantOptions() {
    const productId = document.getElementById('stockProduct').value;
    const variantSelect = document.getElementById('stockVariant');
    
    if (!productId) {
      variantSelect.disabled = true;
      variantSelect.innerHTML = '<option value="">S√©lectionner un variant...</option>';
      return;
    }
    
    const product = this.productCatalog.find(p => p.id == productId);
    if (product) {
      variantSelect.disabled = false;
      variantSelect.innerHTML = '<option value="">S√©lectionner un variant...</option>' +
        Object.keys(product.variants).map(v => `<option value="${v}">${v}</option>`).join('');
    }
  },

  viewOrder(id) {
    const order = this.state.data.orders.find(o => o.id === id);
    if (!order) return;
    
    this.showModal(`D√©tails de la commande #${id}`, `
      <div style="line-height:1.8">
        <p><strong>üìÖ Date:</strong> ${order.date}</p>
        <p><strong>üë§ Client:</strong> ${order.customer}</p>
        <p><strong>üõçÔ∏è Produits:</strong> ${order.products}</p>
        <p><strong>üí∞ Total:</strong> ${this.formatCurrency(order.total)}</p>
        <p><strong>üìä Statut:</strong> ${this.getStatusBadge(order.status)}</p>
        <p><strong>üí≥ Paiement:</strong> <span class="badge">${order.payment}</span></p>
        ${order.email ? `<p><strong>üìß Email:</strong> ${order.email}</p>` : ''}
        ${order.phone ? `<p><strong>üì± T√©l√©phone:</strong> ${order.phone}</p>` : ''}
        ${order.deliveryAddress ? `<p><strong>üìç Adresse:</strong> ${order.deliveryAddress}</p>` : ''}
      </div>
      <div style="margin-top:20px;display:grid;gap:12px">
        <button onclick="App.updateOrderStatus(${id}, 'processing')" style="background:var(--info)">üîÑ Mettre en traitement</button>
        <button onclick="App.updateOrderStatus(${id}, 'delivered')" style="background:var(--success)">‚úÖ Marquer comme livr√©</button>
        <button onclick="App.updateOrderStatus(${id}, 'cancelled')" style="background:var(--danger)">‚ùå Annuler</button>
      </div>
    `);
  },

  editOrder(id) {
    const order = this.state.data.orders.find(o => o.id === id);
    if (!order) return;
    
    this.showModal(`√âditer la commande #${id}`, `
      <div class="form-group">
        <label>Client</label>
        <input type="text" id="editOrderCustomer" value="${order.customer}">
      </div>
      <div class="form-group">
        <label>Produits</label>
        <input type="text" id="editOrderProducts" value="${order.products}">
      </div>
      <div class="form-group">
        <label>Total (‚Ç¨)</label>
        <input type="number" id="editOrderTotal" value="${order.total}" step="0.01">
      </div>
      <div class="form-group">
        <label>Statut</label>
        <select id="editOrderStatus">
          <option value="pending" ${order.status === 'pending' ? 'selected' : ''}>En attente</option>
          <option value="processing" ${order.status === 'processing' ? 'selected' : ''}>En traitement</option>
          <option value="delivered" ${order.status === 'delivered' ? 'selected' : ''}>Livr√©</option>
          <option value="cancelled" ${order.status === 'cancelled' ? 'selected' : ''}>Annul√©</option>
        </select>
      </div>
      <div class="form-group">
        <label>Paiement</label>
        <select id="editOrderPayment">
          <option ${order.payment === 'Esp√®ces' ? 'selected' : ''}>Esp√®ces</option>
          <option ${order.payment === 'CB' ? 'selected' : ''}>CB</option>
          <option ${order.payment === 'Crypto' ? 'selected' : ''}>Crypto</option>
          <option ${order.payment === 'Virement' ? 'selected' : ''}>Virement</option>
        </select>
      </div>
      <button onclick="App.saveOrderEdit(${id})">üíæ Sauvegarder</button>
    `);
  },
  
  updateOrderStatus(id, status) {
    const order = this.state.data.orders.find(o => o.id === id);
    if (order) {
      order.status = status;
      this.saveData();
      this.loadOrders();
      this.closeModal();
      this.showToast(`Commande #${id} mise √† jour`, 'success');
    }
  },
  
  saveOrderEdit(id) {
    const order = this.state.data.orders.find(o => o.id === id);
    if (order) {
      order.customer = document.getElementById('editOrderCustomer').value;
      order.products = document.getElementById('editOrderProducts').value;
      order.total = parseFloat(document.getElementById('editOrderTotal').value);
      order.status = document.getElementById('editOrderStatus').value;
      order.payment = document.getElementById('editOrderPayment').value;
      
      this.saveData();
      this.loadOrders();
      this.updateStats();
      this.closeModal();
      this.showToast('Commande mise √† jour', 'success');
    }
  },

  deleteOrder(id) {
    if (confirm('Supprimer cette commande ?')) {
      this.state.data.orders = this.state.data.orders.filter(o => o.id !== id);
      this.saveData();
      this.loadOrders();
      this.updateStats();
      this.showToast('Commande supprim√©e', 'success');
    }
  },

  addNewOrder() {
    this.showModal('Nouvelle commande', `
      <div class="form-group">
        <label>Client</label>
        <select id="newOrderCustomer">
          <option value="">S√©lectionner un client...</option>
          ${this.state.data.customers.map(c => `<option value="${c.name}">${c.name}</option>`).join('')}
          <option value="new">‚ûï Nouveau client...</option>
        </select>
      </div>
      <div class="form-group" id="newCustomerName" style="display:none">
        <label>Nom du nouveau client</label>
        <input type="text" id="newOrderCustomerName" placeholder="Nom complet">
      </div>
      <div class="form-group">
        <label>Produits</label>
        <textarea id="newOrderProducts" rows="3" placeholder="Ex: AMNESIA 5G, EL JEFE 1G"></textarea>
      </div>
      <div class="form-group">
        <label>Total (‚Ç¨)</label>
        <input type="number" id="newOrderTotal" step="0.01" min="0" placeholder="0.00">
      </div>
      <div class="form-group">
        <label>Paiement</label>
        <select id="newOrderPayment">
          <option>Esp√®ces</option>
          <option>CB</option>
          <option>Crypto</option>
          <option>Virement</option>
        </select>
      </div>
      <button onclick="App.saveNewOrder()">üíæ Cr√©er la commande</button>
    `);
    
    document.getElementById('newOrderCustomer').addEventListener('change', (e) => {
      const newCustomerDiv = document.getElementById('newCustomerName');
      newCustomerDiv.style.display = e.target.value === 'new' ? 'block' : 'none';
    });
  },
  
  saveNewOrder() {
    let customer = document.getElementById('newOrderCustomer').value;
    
    if (customer === 'new') {
      customer = document.getElementById('newOrderCustomerName').value;
      if (!customer) {
        this.showToast('Veuillez entrer le nom du client', 'error');
        return;
      }
    }
    
    const products = document.getElementById('newOrderProducts').value;
    const total = parseFloat(document.getElementById('newOrderTotal').value);
    const payment = document.getElementById('newOrderPayment').value;
    
    if (!customer || !products || !total) {
      this.showToast('Veuillez remplir tous les champs', 'error');
      return;
    }
    
    const newOrder = {
      id: Math.max(...this.state.data.orders.map(o => o.id), 0) + 1,
      date: new Date().toLocaleDateString('fr-FR'),
      customer: customer,
      products: products,
      total: total,
      status: 'pending',
      payment: payment
    };
    
    this.state.data.orders.unshift(newOrder);
    this.saveData();
    this.loadOrders();
    this.updateStats();
    this.updateQuickStats();
    this.closeModal();
    this.showToast('Commande cr√©√©e avec succ√®s', 'success');
  },

  exportOrders() {
    const data = JSON.stringify(this.state.data.orders, null, 2);
    const blob = new Blob([data], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `commandes_${Date.now()}.json`;
    a.click();
    this.showToast('Commandes export√©es', 'success');
  },

  searchOrders() {
    const searchTerm = document.getElementById('searchOrders').value.toLowerCase();
    const filterStatus = document.getElementById('filterStatus').value;
    
    let filteredOrders = this.state.data.orders;
    
    if (searchTerm) {
      filteredOrders = filteredOrders.filter(order =>
        order.customer.toLowerCase().includes(searchTerm) ||
        order.products.toLowerCase().includes(searchTerm) ||
        order.id.toString().includes(searchTerm)
      );
    }
    
    if (filterStatus !== 'all') {
      filteredOrders = filteredOrders.filter(order => order.status === filterStatus);
    }
    
    this.displayFilteredOrders(filteredOrders);
  },

  filterOrders() {
    this.searchOrders();
  },
  
  displayFilteredOrders(orders) {
    const tbody = document.getElementById('ordersTable');
    
    if (orders.length === 0) {
      tbody.innerHTML = '<tr><td colspan="8" class="empty-state">Aucune commande trouv√©e</td></tr>';
      return;
    }
    
    tbody.innerHTML = orders.map(order => `
      <tr>
        <td><strong>#${order.id}</strong></td>
        <td>${order.date}</td>
        <td>${order.customer}</td>
        <td>${order.products}</td>
        <td><strong>${this.formatCurrency(order.total)}</strong></td>
        <td>${this.getStatusBadge(order.status)}</td>
        <td><span class="badge">${order.payment}</span></td>
        <td class="actions">
          <button class="btn-sm btn-primary" onclick="App.viewOrder(${order.id})">üëÅÔ∏è</button>
          <button class="btn-sm btn-success" onclick="App.editOrder(${order.id})">‚úèÔ∏è</button>
          <button class="btn-sm btn-danger" onclick="App.deleteOrder(${order.id})">üóëÔ∏è</button>
        </td>
      </tr>
    `).join('');
  },

  editProduct(id) {
    const product = this.productCatalog.find(p => p.id === id);
    if (!product) return;
    
    const variantsHtml = Object.entries(product.variants).map(([variant, data]) => `
      <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;padding:12px;background:var(--bg-secondary);border-radius:8px;margin-bottom:8px">
        <div>
          <label style="font-size:11px;color:var(--muted)">Variant</label>
          <input type="text" value="${variant}" disabled style="background:var(--card)">
        </div>
        <div>
          <label style="font-size:11px;color:var(--muted)">Prix (‚Ç¨)</label>
          <input type="number" id="price_${variant.replace(/[^a-zA-Z0-9]/g, '_')}" value="${data.price}" step="0.01">
        </div>
        <div>
          <label style="font-size:11px;color:var(--muted)">Stock</label>
          <input type="number" id="stock_${variant.replace(/[^a-zA-Z0-9]/g, '_')}" value="${data.stock}">
        </div>
      </div>
    `).join('');
    
    this.showModal(`√âditer ${product.name}`, `
      <div class="form-group">
        <label>Nom du produit</label>
        <input type="text" id="editProductName" value="${product.name}">
      </div>
      <div class="form-group">
        <label>Cat√©gorie</label>
        <select id="editProductCategory">
          <option value="fleurs" ${product.category === 'fleurs' ? 'selected' : ''}>üåø Fleurs</option>
          <option value="resines" ${product.category === 'resines' ? 'selected' : ''}>üü´ R√©sines</option>
          <option value="cali" ${product.category === 'cali' ? 'selected' : ''}>Cali</option>
          <option value="filtr√©" ${product.category === 'filtr√©' ? 'selected' : ''}>Filtr√©</option>
          <option value="bonbon" ${product.category === 'bonbon' ? 'selected' : ''}>Bonbon</option>
          <option value="blanche" ${product.category === 'blanche' ? 'selected' : ''}>Blanche</option>
          <option value="keta" ${product.category === 'keta' ? 'selected' : ''}>Keta</option>
          <option value="mdma" ${product.category === 'mdma' ? 'selected' : ''}>MDMA</option>
        </select>
      </div>
      <div class="form-group">
        <label>Prix d'achat (‚Ç¨/g ou unit√©)</label>
        <input type="number" id="editProductBuyPrice" value="${product.buyPrice}" step="0.01">
      </div>
      <div class="form-group">
        <label>Variants</label>
        ${variantsHtml}
      </div>
      <button onclick="App.saveProductEdit(${id})">üíæ Sauvegarder</button>
    `);
  },
  
  saveProductEdit(id) {
    const product = this.productCatalog.find(p => p.id === id);
    if (!product) return;
    
    product.name = document.getElementById('editProductName').value;
    product.category = document.getElementById('editProductCategory').value;
    product.buyPrice = parseFloat(document.getElementById('editProductBuyPrice').value);
    
    Object.keys(product.variants).forEach(variant => {
      const variantId = variant.replace(/[^a-zA-Z0-9]/g, '_');
      const priceInput = document.getElementById(`price_${variantId}`);
      const stockInput = document.getElementById(`stock_${variantId}`);
      
      if (priceInput && stockInput) {
        product.variants[variant].price = parseFloat(priceInput.value);
        product.variants[variant].stock = parseInt(stockInput.value);
      }
    });
    
    this.saveData();
    this.loadProducts();
    this.loadStock();
    this.updateStats();
    this.closeModal();
    this.showToast('Produit mis √† jour', 'success');
  },

  viewProductStock(id) {
    const product = this.productCatalog.find(p => p.id === id);
    if (product) {
      this.showModal('Stock de ' + product.name, 
        Object.entries(product.variants).map(([v, d]) => 
          `<p>${v}: ${d.stock} unit√©s √† ${this.formatCurrency(d.price)}</p>`
        ).join('')
      );
    }
  },

  deleteProduct(id) {
    if (id <= 12) {
      this.showToast('Les produits du catalogue de base ne peuvent pas √™tre supprim√©s', 'warning');
      return;
    }
    
    if (confirm('Supprimer ce produit ?')) {
      const index = this.productCatalog.findIndex(p => p.id === id);
      if (index !== -1) {
        this.productCatalog.splice(index, 1);
        this.saveData();
        this.loadProducts();
        this.loadStock();
        this.updateStats();
        this.showToast('Produit supprim√©', 'success');
      }
    }
  },

  addNewProduct() {
    this.showModal('Nouveau produit', `
      <div class="form-group">
        <label>Nom du produit</label>
        <input type="text" id="newProductName" placeholder="Ex: GELATO">
      </div>
      <div class="form-group">
        <label>Cat√©gorie</label>
        <select id="newProductCategory">
          <option value="fleurs">üåø Fleurs</option>
          <option value="resines">üü´ R√©sines</option>
          <option value="cali">Cali</option>
          <option value="filtr√©">Filtr√©</option>
          <option value="bonbon">Bonbon</option>
          <option value="blanche">Blanche</option>
          <option value="keta">Keta</option>
          <option value="mdma">MDMA</option>
        </select>
      </div>
      <div class="form-group">
        <label>Prix d'achat (‚Ç¨/g ou unit√©)</label>
        <input type="number" id="newProductBuyPrice" step="0.01" min="0" placeholder="0.00">
      </div>
      <div class="form-group">
        <label>Variant 1 (Ex: 5G)</label>
        <input type="text" id="variant1Name" placeholder="5G">
      </div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px">
        <div>
          <label style="font-size:12px;color:var(--muted)">Prix (‚Ç¨)</label>
          <input type="number" id="variant1Price" step="0.01" placeholder="30">
        </div>
        <div>
          <label style="font-size:12px;color:var(--muted)">Stock</label>
          <input type="number" id="variant1Stock" placeholder="50">
        </div>
      </div>
      <button onclick="App.saveNewProduct()">üíæ Cr√©er le produit</button>
      <p style="margin-top:12px;font-size:12px;color:var(--muted)">üí° Vous pourrez ajouter plus de variants apr√®s cr√©ation</p>
    `);
  },
  
  saveNewProduct() {
    const name = document.getElementById('newProductName').value.trim();
    const category = document.getElementById('newProductCategory').value;
    const buyPrice = parseFloat(document.getElementById('newProductBuyPrice').value);
    const variantName = document.getElementById('variant1Name').value.trim();
    const variantPrice = parseFloat(document.getElementById('variant1Price').value);
    const variantStock = parseInt(document.getElementById('variant1Stock').value);
    
    if (!name) {
      this.showToast('Veuillez entrer un nom de produit', 'error');
      return;
    }
    
    if (!buyPrice || buyPrice <= 0) {
      this.showToast('Veuillez entrer un prix d\'achat valide', 'error');
      return;
    }
    
    if (!variantName) {
      this.showToast('Veuillez entrer un nom de variant', 'error');
      return;
    }
    
    if (!variantPrice || variantPrice <= 0) {
      this.showToast('Veuillez entrer un prix de vente valide', 'error');
      return;
    }
    
    if (isNaN(variantStock) || variantStock < 0) {
      this.showToast('Veuillez entrer un stock valide', 'error');
      return;
    }
    
    const newProduct = {
      id: Math.max(...this.productCatalog.map(p => p.id), 0) + 1,
      name: name,
      category: category,
      buyPrice: buyPrice,
      variants: {
        [variantName]: {
          price: variantPrice,
          stock: variantStock
        }
      }
    };
    
    this.productCatalog.push(newProduct);
    
    this.saveData();
    
    this.loadProducts();
    this.loadStock();
    this.updateStats();
    this.initCalculator();
    
    this.closeModal();
    this.showToast(`Produit "${name}" cr√©√© avec succ√®s !`, 'success');
  },

  refreshProducts() {
    this.loadProducts();
    this.showToast('Produits actualis√©s', 'success');
  },

  searchProducts() {
    const searchTerm = document.getElementById('searchProducts').value.toLowerCase();
    const filterCategory = document.getElementById('filterCategory').value;
    
    let filteredProducts = this.productCatalog;
    
    if (searchTerm) {
      filteredProducts = filteredProducts.filter(product =>
        product.name.toLowerCase().includes(searchTerm) ||
        product.category.toLowerCase().includes(searchTerm) ||
        product.id.toString().includes(searchTerm)
      );
    }
    
    if (filterCategory !== 'all') {
      filteredProducts = filteredProducts.filter(product => product.category === filterCategory);
    }
    
    this.displayFilteredProducts(filteredProducts);
  },

  filterProducts() {
    this.searchProducts();
  },
  
  displayFilteredProducts(products) {
    const tbody = document.getElementById('productsTable');
    
    if (products.length === 0) {
      tbody.innerHTML = '<tr><td colspan="8" class="empty-state">Aucun produit trouv√©</td></tr>';
      return;
    }
    
    tbody.innerHTML = products.map(product => {
      const variants = Object.keys(product.variants).length;
      const prices = Object.values(product.variants).map(v => v.price);
      const minPrice = Math.min(...prices);
      const totalStock = Object.values(product.variants).reduce((sum, v) => sum + v.stock, 0);
      
      let status = 'active';
      if (totalStock === 0) status = 'out';
      else if (totalStock < 20) status = 'low';
      
      return `
        <tr>
          <td><strong>#${product.id}</strong></td>
          <td><strong>${product.name}</strong></td>
          <td><span class="badge">${this.getCategoryBadge(product.category)}</span></td>
          <td>${variants} variants</td>
          <td>${this.formatCurrency(minPrice)}</td>
          <td>${totalStock} unit√©s</td>
          <td>${this.getStockBadge(status)}</td>
          <td class="actions">
            <button class="btn-sm btn-primary" onclick="App.editProduct(${product.id})">‚úèÔ∏è</button>
            <button class="btn-sm btn-success" onclick="App.viewProductStock(${product.id})">üìä</button>
            <button class="btn-sm btn-danger" onclick="App.deleteProduct(${product.id})">üóëÔ∏è</button>
          </td>
        </tr>
      `;
    }).join('');
  },

  quickAddStock(productName, variant) {
    const qty = prompt(`Quantit√© √† ajouter pour ${productName} ${variant}:`, '10');
    if (qty && !isNaN(qty)) {
      const product = this.productCatalog.find(p => p.name === productName);
      if (product && product.variants[variant]) {
        product.variants[variant].stock += parseInt(qty);
        this.saveData();
        this.loadStock();
        this.updateStats();
        this.showToast(`${qty} unit√©s ajout√©es`, 'success');
      }
    }
  },

  quickAdjustStock(productName, variant) {
    const product = this.productCatalog.find(p => p.name === productName);
    if (product && product.variants[variant]) {
      const currentStock = product.variants[variant].stock;
      const newQty = prompt(`Nouveau stock pour ${productName} ${variant}:`, currentStock);
      if (newQty !== null && !isNaN(newQty)) {
        product.variants[variant].stock = parseInt(newQty);
        this.saveData();
        this.loadStock();
        this.updateStats();
        this.showToast('Stock ajust√©', 'success');
      }
    }
  },

  addStock() {
    const productId = document.getElementById('stockProduct').value;
    const variant = document.getElementById('stockVariant').value;
    const qty = document.getElementById('stockQty').value;
    
    if (!productId || !variant || !qty) {
      this.showToast('Veuillez remplir tous les champs', 'error');
      return;
    }
    
    const product = this.productCatalog.find(p => p.id == productId);
    if (product && product.variants[variant]) {
      product.variants[variant].stock += parseInt(qty);
      this.saveData();
      this.loadStock();
      this.updateStats();
      this.showToast(`${qty} unit√©s ajout√©es au stock`, 'success');
      
      document.getElementById('stockProduct').value = '';
      document.getElementById('stockVariant').value = '';
      document.getElementById('stockVariant').disabled = true;
      document.getElementById('stockQty').value = '';
    }
  },

  adjustStock() {
    const productId = document.getElementById('stockProduct').value;
    const variant = document.getElementById('stockVariant').value;
    const qty = document.getElementById('stockQty').value;
    
    if (!productId || !variant || qty === '') {
      this.showToast('Veuillez remplir tous les champs', 'error');
      return;
    }
    
    const product = this.productCatalog.find(p => p.id == productId);
    if (product && product.variants[variant]) {
      product.variants[variant].stock = parseInt(qty);
      this.saveData();
      this.loadStock();
      this.updateStats();
      this.showToast('Stock ajust√©', 'success');
      
      document.getElementById('stockProduct').value = '';
      document.getElementById('stockVariant').value = '';
      document.getElementById('stockVariant').disabled = true;
      document.getElementById('stockQty').value = '';
    }
  },

  viewCustomer(id) {
    const customer = this.state.data.customers.find(c => c.id === id);
    if (customer) {
      this.showModal('Client: ' + customer.name,
        `<p><strong>Email:</strong> ${customer.email}</p>
         <p><strong>T√©l√©phone:</strong> ${customer.phone}</p>
         <p><strong>Commandes:</strong> ${customer.orders}</p>
         <p><strong>Total d√©pens√©:</strong> ${this.formatCurrency(customer.totalSpent)}</p>
         <p><strong>Statut:</strong> ${customer.status.toUpperCase()}</p>`
      );
    }
  },

  sendMessage(id) {
    const customer = this.state.data.customers.find(c => c.id === id);
    if (!customer) return;
    
    this.showModal(`Message √† ${customer.name}`, `
      <div class="form-group">
        <label>Destinataire</label>
        <input type="text" value="${customer.name} (${customer.email})" disabled>
      </div>
      <div class="form-group">
        <label>Canal</label>
        <select id="messageChannel">
          <option value="email">üìß Email</option>
          <option value="sms">üì± SMS (${customer.phone})</option>
          <option value="whatsapp">üí¨ WhatsApp</option>
        </select>
      </div>
      <div class="form-group">
        <label>Mod√®le de message</label>
        <select id="messageTemplate" onchange="App.loadMessageTemplate()">
          <option value="">Message personnalis√©</option>
          <option value="promo">üéâ Promotion sp√©ciale</option>
          <option value="stock">üì¶ Nouveau stock disponible</option>
          <option value="reminder">‚è∞ Rappel de commande</option>
          <option value="thanks">üíù Remerciement</option>
        </select>
      </div>
      <div class="form-group">
        <label>Message</label>
        <textarea id="messageContent" rows="5" placeholder="Votre message..."></textarea>
      </div>
      <button onclick="App.sendCustomerMessage(${id})">üì§ Envoyer</button>
    `);
  },
  
  loadMessageTemplate() {
    const template = document.getElementById('messageTemplate').value;
    const textarea = document.getElementById('messageContent');
    
    const templates = {
      promo: 'üéâ Bonjour ! Promotion exclusive pour vous : -20% sur votre prochaine commande avec le code VIP20. Valable jusqu\'au dimanche !',
      stock: 'üì¶ Bonne nouvelle ! Le produit que vous aimez est de nouveau en stock. Passez commande d√®s maintenant !',
      reminder: '‚è∞ Bonjour ! Votre commande est pr√™te √† √™tre r√©cup√©r√©e. N\'oubliez pas de passer nous voir.',
      thanks: 'üíù Merci pour votre commande ! Votre satisfaction est notre priorit√©. √Ä tr√®s bient√¥t !'
    };
    
    if (template && templates[template]) {
      textarea.value = templates[template];
    }
  },
  
  sendCustomerMessage(id) {
    const channel = document.getElementById('messageChannel').value;
    const content = document.getElementById('messageContent').value;
    
    if (!content) {
      this.showToast('Veuillez √©crire un message', 'error');
      return;
    }
    
    this.closeModal();
    this.showToast(`Message envoy√© via ${channel === 'email' ? 'email' : channel === 'sms' ? 'SMS' : 'WhatsApp'}`, 'success');
  },

  deleteCustomer(id) {
    if (confirm('Supprimer ce client ?')) {
      this.state.data.customers = this.state.data.customers.filter(c => c.id !== id);
      this.saveData();
      this.loadCustomers();
      this.updateStats();
      this.showToast('Client supprim√©', 'success');
    }
  },

  addNewCustomer() {
    this.showModal('Nouveau client', `
      <div class="form-group">
        <label>Nom complet</label>
        <input type="text" id="newCustomerName" placeholder="Ex: Pierre Dubois">
      </div>
      <div class="form-group">
        <label>Email</label>
        <input type="email" id="newCustomerEmail" placeholder="pierre@email.com">
      </div>
      <div class="form-group">
        <label>T√©l√©phone</label>
        <input type="tel" id="newCustomerPhone" placeholder="06 12 34 56 78">
      </div>
      <div class="form-group">
        <label>Statut</label>
        <select id="newCustomerStatus">
          <option value="new">üÜï Nouveau</option>
          <option value="regular">üë§ R√©gulier</option>
          <option value="vip">‚≠ê VIP</option>
        </select>
      </div>
      <div class="form-group">
        <label>Notes</label>
        <textarea id="newCustomerNotes" rows="3" placeholder="Informations suppl√©mentaires..."></textarea>
      </div>
      <button onclick="App.saveNewCustomer()">üíæ Cr√©er le client</button>
    `);
  },
  
  saveNewCustomer() {
    const name = document.getElementById('newCustomerName').value;
    const email = document.getElementById('newCustomerEmail').value;
    const phone = document.getElementById('newCustomerPhone').value;
    const status = document.getElementById('newCustomerStatus').value;
    
    if (!name || !email || !phone) {
      this.showToast('Veuillez remplir tous les champs obligatoires', 'error');
      return;
    }
    
    const newCustomer = {
      id: Math.max(...this.state.data.customers.map(c => c.id), 0) + 1,
      name: name,
      email: email,
      phone: phone,
      orders: 0,
      totalSpent: 0,
      status: status
    };
    
    this.state.data.customers.push(newCustomer);
    this.saveData();
    this.loadCustomers();
    this.updateStats();
    this.updateQuickStats();
    this.closeModal();
    this.showToast('Client cr√©√© avec succ√®s', 'success');
  },

  exportCustomers() {
    const data = JSON.stringify(this.state.data.customers, null, 2);
    const blob = new Blob([data], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `clients_${Date.now()}.json`;
    a.click();
    this.showToast('Clients export√©s', 'success');
  },

  searchCustomers() {
    const searchTerm = document.getElementById('searchCustomers').value.toLowerCase();
    const filterType = document.getElementById('filterCustomerType').value;
    
    let filteredCustomers = this.state.data.customers;
    
    if (searchTerm) {
      filteredCustomers = filteredCustomers.filter(customer =>
        customer.name.toLowerCase().includes(searchTerm) ||
        customer.email.toLowerCase().includes(searchTerm) ||
        customer.phone.includes(searchTerm) ||
        customer.id.toString().includes(searchTerm)
      );
    }
    
    if (filterType !== 'all') {
      filteredCustomers = filteredCustomers.filter(customer => customer.status === filterType);
    }
    
    this.displayFilteredCustomers(filteredCustomers);
  },

  filterCustomers() {
    this.searchCustomers();
  },
  
  displayFilteredCustomers(customers) {
    const tbody = document.getElementById('customersTable');
    
    if (customers.length === 0) {
      tbody.innerHTML = '<tr><td colspan="8" class="empty-state">Aucun client trouv√©</td></tr>';
      return;
    }
    
    tbody.innerHTML = customers.map(customer => `
      <tr>
        <td><strong>#${customer.id}</strong></td>
        <td><strong>${customer.name}</strong></td>
        <td>${customer.email}</td>
        <td>${customer.phone}</td>
        <td>${customer.orders} commandes</td>
        <td><strong>${this.formatCurrency(customer.totalSpent)}</strong></td>
        <td>${this.getCustomerBadge(customer.status)}</td>
        <td class="actions">
          <button class="btn-sm btn-primary" onclick="App.viewCustomer(${customer.id})">üëÅÔ∏è</button>
          <button class="btn-sm btn-success" onclick="App.sendMessage(${customer.id})">üí¨</button>
          <button class="btn-sm btn-danger" onclick="App.deleteCustomer(${customer.id})">üóëÔ∏è</button>
        </td>
      </tr>
    `).join('');
  },

  showSettings() {
    this.switchTab('settings');
  },

  saveSettings() {
    const settings = {
      shopName: document.getElementById('shopName').value,
      shopEmail: document.getElementById('shopEmail').value,
      shopPhone: document.getElementById('shopPhone').value
    };
    localStorage.setItem('shop_settings', JSON.stringify(settings));
    this.showToast('Param√®tres sauvegard√©s', 'success');
  },

  updatePassword() {
    const oldPass = document.getElementById('oldPassword').value;
    const newPass = document.getElementById('newPassword').value;
    const confirmPass = document.getElementById('confirmPassword').value;
    
    if (newPass !== confirmPass) {
      this.showToast('Les mots de passe ne correspondent pas', 'error');
      return;
    }
    
    if (newPass.length < 8) {
      this.showToast('Le mot de passe doit contenir au moins 8 caract√®res', 'error');
      return;
    }
    
    this.showToast('Mot de passe mis √† jour (simulation)', 'success');
    
    document.getElementById('oldPassword').value = '';
    document.getElementById('newPassword').value = '';
    document.getElementById('confirmPassword').value = '';
  },

  exportAllData() {
    const data = {
      orders: this.state.data.orders,
      products: this.productCatalog,
      customers: this.state.data.customers,
      cash: this.state.cash,
      exportDate: new Date().toISOString(),
      version: '2.0.0'
    };
    
    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `drogua_export_complet_${Date.now()}.json`;
    a.click();
    
    this.showToast('Export complet r√©ussi', 'success');
  },

  importData() {
    this.showToast('Fonction d\'import en d√©veloppement', 'warning');
  },

  clearAllData() {
    if (confirm('‚ö†Ô∏è ATTENTION : Cette action supprimera TOUTES les donn√©es. √ätes-vous s√ªr ?')) {
      if (confirm('‚ö†Ô∏è DERNI√àRE CONFIRMATION : Toutes les donn√©es seront perdues d√©finitivement !')) {
        localStorage.clear();
        this.showToast('Toutes les donn√©es ont √©t√© supprim√©es', 'success');
        setTimeout(() => location.reload(), 2000);
      }
    }
  },

  // === FONCTIONS CAISSE ===
  loadCashier() {
    document.getElementById('cashTotal').textContent = this.formatCurrency(this.state.cash.total);
    document.getElementById('cashLastUpdate').textContent = new Date().toLocaleTimeString('fr-FR');
    
    const today = new Date().toDateString();
    const todayTransactions = this.state.cash.transactions.filter(t => 
      new Date(t.date).toDateString() === today
    );
    
    const todayIncome = todayTransactions
      .filter(t => t.type === 'income')
      .reduce((sum, t) => sum + t.amount, 0);
    
    const todayExpense = todayTransactions
      .filter(t => t.type === 'expense')
      .reduce((sum, t) => sum + t.amount, 0);
    
    document.getElementById('todayIncome').textContent = this.formatCurrency(todayIncome);
    document.getElementById('todayIncomeCount').textContent = todayTransactions.filter(t => t.type === 'income').length;
    document.getElementById('todayExpense').textContent = this.formatCurrency(todayExpense);
    document.getElementById('todayExpenseCount').textContent = todayTransactions.filter(t => t.type === 'expense').length;
    document.getElementById('todayBalance').textContent = this.formatCurrency(todayIncome - todayExpense);
    
    const total = todayIncome + todayExpense || 1;
    const balancePercent = (todayIncome / total) * 100;
    document.getElementById('balanceBar').style.width = balancePercent + '%';
    
    this.loadTransactionHistory();
    
    document.getElementById('currentCash').textContent = this.formatCurrency(this.state.cash.total);
    document.getElementById('cashDetails').innerHTML = 
      `<span style="color:var(--success)">Entr√©es: ${this.formatCurrency(todayIncome)}</span> ‚Ä¢ <span style="color:var(--danger)">Sorties: ${this.formatCurrency(todayExpense)}</span>`;
  },

  loadTransactionHistory() {
    const tbody = document.getElementById('transactionHistory');
    const today = new Date().toDateString();
    const todayTransactions = this.state.cash.transactions.filter(t => 
      new Date(t.date).toDateString() === today
    ).reverse();
    
    if (todayTransactions.length === 0) {
      tbody.innerHTML = '<tr><td colspan="6" class="empty-state">Aucune transaction aujourd\'hui</td></tr>';
      return;
    }
    
    tbody.innerHTML = todayTransactions.map((trans, index) => `
      <tr>
        <td>${new Date(trans.date).toLocaleTimeString('fr-FR', {hour: '2-digit', minute: '2-digit'})}</td>
        <td>${this.getTransactionTypeBadge(trans.type)}</td>
        <td>${trans.description || '-'}</td>
        <td style="color:${trans.type === 'income' ? 'var(--success)' : 'var(--danger)'}">
          ${trans.type === 'income' ? '+' : '-'}${this.formatCurrency(trans.amount)}
        </td>
        <td><strong>${this.formatCurrency(trans.balanceAfter)}</strong></td>
        <td>
          <button class="btn-sm btn-danger" onclick="App.cancelTransaction(${index})">‚ùå</button>
        </td>
      </tr>
    `).join('');
  },

  addTransaction() {
    const type = document.getElementById('transType').value;
    const amount = parseFloat(document.getElementById('transAmount').value);
    const category = document.getElementById('transCategory').value;
    const description = document.getElementById('transDescription').value;
    
    if (!amount || amount <= 0) {
      this.showToast('Veuillez entrer un montant valide', 'error');
      return;
    }
    
    if (type === 'expense' && amount > this.state.cash.total) {
      this.showToast('Caisse insuffisante pour cette sortie', 'error');
      return;
    }
    
    let newTotal = this.state.cash.total;
    if (type === 'income') {
      newTotal += amount;
    } else if (type === 'expense') {
      newTotal -= amount;
    } else if (type === 'adjustment') {
      newTotal = amount;
    }
    
    const transaction = {
      id: Date.now(),
      date: new Date().toISOString(),
      type: type,
      amount: amount,
      category: category,
      description: description || `${type === 'income' ? 'Vente' : 'Achat'} - ${category}`,
      balanceAfter: newTotal
    };
    
    this.state.cash.transactions.push(transaction);
    this.state.cash.total = newTotal;
    
    this.saveCashData();
    
    this.loadCashier();
    
    document.getElementById('transAmount').value = '';
    document.getElementById('transDescription').value = '';
    
    this.showToast('Transaction enregistr√©e', 'success');
  },

  cancelTransaction(index) {
    if (!confirm('Annuler cette transaction ?')) return;
    
    const today = new Date().toDateString();
    const todayTransactions = this.state.cash.transactions.filter(t => 
      new Date(t.date).toDateString() === today
    ).reverse();
    
    const transaction = todayTransactions[index];
    if (!transaction) return;
    
    if (transaction.type === 'income') {
      this.state.cash.total -= transaction.amount;
    } else if (transaction.type === 'expense') {
      this.state.cash.total += transaction.amount;
    }
    
    const transIndex = this.state.cash.transactions.findIndex(t => t.id === transaction.id);
    this.state.cash.transactions.splice(transIndex, 1);
    
    this.saveCashData();
    this.loadCashier();
    this.showToast('Transaction annul√©e', 'warning');
  },

  quickSale(amount) {
    this.state.cash.total += amount;
    this.state.cash.transactions.push({
      id: Date.now(),
      date: new Date().toISOString(),
      type: 'income',
      amount: amount,
      category: 'sale',
      description: `Vente rapide ${amount}‚Ç¨`,
      balanceAfter: this.state.cash.total
    });
    
    this.saveCashData();
    this.loadCashier();
    this.showToast(`Vente de ${amount}‚Ç¨ enregistr√©e`, 'success');
  },

  openCashCount() {
    const counted = prompt('Montant compt√© dans la caisse (‚Ç¨):', this.state.cash.total);
    if (counted !== null && !isNaN(counted)) {
      const difference = parseFloat(counted) - this.state.cash.total;
      
      if (Math.abs(difference) > 0.01) {
        const confirmed = confirm(`√âcart de ${this.formatCurrency(difference)}. Ajuster la caisse ?`);
        if (confirmed) {
          this.state.cash.transactions.push({
            id: Date.now(),
            date: new Date().toISOString(),
            type: 'adjustment',
            amount: parseFloat(counted),
            category: 'adjustment',
            description: `Ajustement caisse (√©cart: ${this.formatCurrency(difference)})`,
            balanceAfter: parseFloat(counted)
          });
          this.state.cash.total = parseFloat(counted);
          this.saveCashData();
          this.loadCashier();
          this.showToast('Caisse ajust√©e', 'success');
        }
      } else {
        this.showToast('Caisse correcte !', 'success');
      }
    }
  },

  closeCashRegister() {
    const today = new Date().toDateString();
    const todayTransactions = this.state.cash.transactions.filter(t => 
      new Date(t.date).toDateString() === today
    );
    
    const todayIncome = todayTransactions
      .filter(t => t.type === 'income')
      .reduce((sum, t) => sum + t.amount, 0);
    
    const todayExpense = todayTransactions
      .filter(t => t.type === 'expense')
      .reduce((sum, t) => sum + t.amount, 0);
    
    const message = `
      CL√îTURE DE CAISSE
      ==================
      Entr√©es: ${this.formatCurrency(todayIncome)}
      Sorties: ${this.formatCurrency(todayExpense)}
      Balance: ${this.formatCurrency(todayIncome - todayExpense)}
      ==================
      Caisse finale: ${this.formatCurrency(this.state.cash.total)}
    `;
    
    if (confirm(message + '\n\nConfirmer la cl√¥ture ?')) {
      const report = {
        date: new Date().toISOString(),
        income: todayIncome,
        expense: todayExpense,
        balance: todayIncome - todayExpense,
        finalCash: this.state.cash.total,
        transactions: todayTransactions.length
      };
      
      let reports = JSON.parse(localStorage.getItem('cash_reports') || '[]');
      reports.push(report);
      localStorage.setItem('cash_reports', JSON.stringify(reports));
      
      this.showToast('Caisse cl√¥tur√©e avec succ√®s', 'success');
      
      this.exportCashReport(report);
    }
  },

  exportCashReport(report) {
    const data = JSON.stringify(report, null, 2);
    const blob = new Blob([data], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `cloture_caisse_${new Date().toISOString().split('T')[0]}.json`;
    a.click();
  },

  saveCashData() {
    localStorage.setItem('cash_data', JSON.stringify(this.state.cash));
    this.saveData();
  },

  updateTransactionForm() {
    const type = document.getElementById('transType').value;
    const categorySelect = document.getElementById('transCategory');
    
    if (type === 'income') {
      categorySelect.innerHTML = `
        <option value="sale">Vente produit</option>
        <option value="service">Service</option>
        <option value="other">Autre entr√©e</option>
      `;
    } else if (type === 'expense') {
      categorySelect.innerHTML = `
        <option value="purchase">Achat stock</option>
        <option value="supplier">Fournisseur</option>
        <option value="operating">Frais de fonctionnement</option>
        <option value="other">Autre d√©pense</option>
      `;
    } else {
      categorySelect.innerHTML = `
        <option value="adjustment">Ajustement caisse</option>
        <option value="correction">Correction d'erreur</option>
      `;
    }
  },

  getTransactionTypeBadge(type) {
    const badges = {
      income: '<span class="badge success">‚ûï Entr√©e</span>',
      expense: '<span class="badge danger">‚ûñ Sortie</span>',
      adjustment: '<span class="badge warning">‚öñÔ∏è Ajustement</span>'
    };
    return badges[type] || type;
  },

  // === CALCULATEUR DE RENTABILIT√â ===
  initCalculator() {
    const productSelect = document.getElementById('calcProduct');
    if (productSelect) {
      productSelect.innerHTML = '<option value="">S√©lectionner un produit...</option>' +
        this.productCatalog.map(p => `<option value="${p.id}">${p.name}</option>`).join('');
    }
  },

  calculateProfit() {
    const productId = document.getElementById('calcProduct').value;
    const weight = parseFloat(document.getElementById('calcWeight').value);
    const buyPrice = parseFloat(document.getElementById('calcBuyPrice').value);
    const sellPrice = parseFloat(document.getElementById('calcSellPrice').value);
    const quantity = parseInt(document.getElementById('calcQuantity').value) || 1;
    
    if (!weight || !buyPrice || !sellPrice) {
      document.getElementById('profitResults').style.display = 'none';
      return;
    }
    
    const totalCost = buyPrice * weight;
    const unitProfit = sellPrice - totalCost;
    const margin = ((unitProfit / sellPrice) * 100).toFixed(1);
    const totalRevenue = sellPrice * quantity;
    const totalProfit = unitProfit * quantity;
    
    document.getElementById('resultCost').textContent = this.formatCurrency(totalCost);
    document.getElementById('resultSell').textContent = this.formatCurrency(sellPrice);
    document.getElementById('resultUnitProfit').textContent = this.formatCurrency(unitProfit);
    document.getElementById('resultMargin').textContent = margin + '%';
    document.getElementById('resultTotalProfit').textContent = this.formatCurrency(totalProfit);
    document.getElementById('resultTotalRevenue').textContent = this.formatCurrency(totalRevenue);
    
    const marginElement = document.getElementById('resultMargin');
    const profitElement = document.getElementById('resultTotalProfit');
    
    if (margin >= 200) {
      marginElement.style.color = 'var(--success)';
      profitElement.style.color = 'var(--success)';
    } else if (margin >= 100) {
      marginElement.style.color = 'var(--warning)';
      profitElement.style.color = 'var(--warning)';
    } else {
      marginElement.style.color = 'var(--danger)';
      profitElement.style.color = 'var(--danger)';
    }
    
    document.getElementById('profitResults').style.display = 'block';
    
    if (productId && !document.getElementById('calcBuyPrice').value) {
      const product = this.productCatalog.find(p => p.id == productId);
      if (product) {
        document.getElementById('calcBuyPrice').value = product.buyPrice;
        this.calculateProfit();
      }
    }
  },

  // Notifications
  toggleNotifications() {
    const notifications = this.state.notifications.slice(0, 10);
    
    if (notifications.length === 0) {
      this.showModal('üîî Notifications', '<p class="empty-state">Aucune notification</p>');
      return;
    }
    
    const notifHtml = notifications.map(notif => `
      <div style="padding:12px;border-bottom:1px solid var(--border);${notif.read ? 'opacity:0.6' : ''}">
        <div style="display:flex;justify-content:space-between;align-items:start;margin-bottom:8px">
          <div style="font-weight:600">${notif.message}</div>
          <span style="font-size:11px;color:var(--muted);white-space:nowrap;margin-left:12px">
            ${this.formatTime(notif.timestamp)}
          </span>
        </div>
      </div>
    `).join('');
    
    this.showModal('üîî Notifications', `
      <div style="max-height:400px;overflow-y:auto">
        ${notifHtml}
      </div>
      <button onclick="App.clearNotifications()" style="margin-top:16px;background:var(--danger)">
        üóëÔ∏è Effacer toutes les notifications
      </button>
    `);
    
    this.state.notifications.forEach(n => n.read = true);
    this.updateNotificationBadge(0);
  },

  clearNotifications() {
    this.state.notifications = [];
    this.updateNotificationBadge(0);
    this.closeModal();
    this.showToast('Notifications effac√©es', 'success');
  },

  formatTime(timestamp) {
    const date = new Date(timestamp);
    const now = new Date();
    const diff = now - date;
    
    if (diff < 60000) return '√Ä l\'instant';
    if (diff < 3600000) return `Il y a ${Math.floor(diff / 60000)} min`;
    if (diff < 86400000) return `Il y a ${Math.floor(diff / 3600000)}h`;
    return date.toLocaleDateString('fr-FR');
  },

  // Th√®me
  toggleTheme() {
    const body = document.body;
    const currentTheme = body.getAttribute('data-theme');
    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
    
    body.setAttribute('data-theme', newTheme);
    document.getElementById('themeToggle').classList.toggle('light', newTheme === 'light');
    localStorage.setItem(this.config.STORAGE_KEYS.THEME, newTheme);
  },

  // Modal
  showModal(title, content) {
    document.getElementById('modalTitle').textContent = title;
    document.getElementById('modalBody').innerHTML = content;
    document.getElementById('modal').classList.add('active');
  },

  closeModal() {
    document.getElementById('modal').classList.remove('active');
  },

  // Utilitaires
  formatCurrency(amount) {
    return new Intl.NumberFormat('fr-FR', {
      style: 'currency',
      currency: 'EUR'
    }).format(amount || 0);
  },

  getStatusBadge(status) {
    const badges = {
      pending: '<span class="badge warning">‚è≥ En attente</span>',
      processing: '<span class="badge info">üîÑ En traitement</span>',
      delivered: '<span class="badge success">‚úÖ Livr√©</span>',
      cancelled: '<span class="badge danger">‚ùå Annul√©</span>'
    };
    return badges[status] || badges.pending;
  },

  getStockBadge(status) {
    const badges = {
      ok: '<span class="badge success">‚úÖ OK</span>',
      active: '<span class="badge success">‚úÖ Actif</span>',
      low: '<span class="badge warning">‚ö†Ô∏è Stock bas</span>',
      out: '<span class="badge danger">‚ùå Rupture</span>'
    };
    return badges[status] || badges.ok;
  },

  getCategoryBadge(category) {
    const badges = {
      blanche: 'blanche',
      keta: 'keta',
      mdma: 'mdma',
      bonbon: 'bonbon',
      cali: 'cali',
      fleurs: 'üåø Fleurs',
      resines: 'üü´ R√©sines',
      filtr√©: 'filtr√©'
    };
    return badges[category] || category;
  },

  getCustomerBadge(status) {
    const badges = {
      vip: '<span class="badge warning">‚≠ê VIP</span>',
      regular: '<span class="badge info">üë§ R√©gulier</span>',
      new: '<span class="badge success">üÜï Nouveau</span>'
    };
    return badges[status] || badges.regular;
  },

  showToast(message, type = 'success') {
    const container = document.getElementById('toastContainer');
    const toast = document.createElement('div');
    toast.className = `toast ${type} show`;
    toast.textContent = message;
    
    container.appendChild(toast);
    
    setTimeout(() => {
      toast.classList.remove('show');
      setTimeout(() => toast.remove(), 300);
    }, 3000);
  }
};

// Initialisation au chargement de la page
document.addEventListener('DOMContentLoaded', () => {
  App.init();
});
</script>

</body>
</html>
